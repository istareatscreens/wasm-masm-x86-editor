let ALLOW_PARAM_OVERRIDE_FROM_URL=!1,SUPPRESS_WINEBOOT=!0,ROOT="/root",STORAGE_DROPBOX="DROPBOX",STORAGE_LOCAL_STORAGE="LOCAL_STORAGE",STORAGE_MEMORY="MEMORY",ONDEMAND_DEFAULT="notset",ONDEMAND_ROOT="root",DROPBOX_APP_KEY="put key in here",RECEIVE_URL="http://put url in here/oauth_receiver.html",DEFAULT_AUTO_RUN=!0,DEFAULT_SOUND_ENABLED=!0,DEFAULT_APP_DIRECTORY=ROOT+"/files/",DEFAULT_BPP=32,DEFAULT_ROOT_ZIP_FILE="boxedwine.zip",Config={locateRootBaseUrl:"",locateAppBaseUrl:"",locateOverlayBaseUrl:"",urlParams:""};Config.storageMode=STORAGE_LOCAL_STORAGE,Config.isRunningInline=!1,Config.showUploadDownload=!1;var selectedItem,selectedFilename,isRunning=!1,uniqueDirs={},timer=null,index=0,files=[],client=null,alreadyBuiltFileSystem=!1,ae=document.createElement("a");document.body.appendChild(ae),ae.style="display: none";var fileFS,url=null,statusElement=document.getElementById("status"),progressElement=document.getElementById("progress"),spinnerElement=document.getElementById("spinner"),flag_r={isReadable:function(){return!0},isWriteable:function(){return!1},isTruncating:function(){return!1},isAppendable:function(){return!1},isSynchronous:function(){return!1},isExclusive:function(){return!1},pathExistsAction:function(){return 0},pathNotExistsAction:function(){return 1}};function setConfiguration(){Config.appDirPrefix=DEFAULT_APP_DIRECTORY,Config.isAutoRunSet=getAutoRun(),Config.rootZipFile="boxedwine.zip",Config.extraZipFiles="",Config.appZipFile="assembler.zip",Config.appPayload=getPayload("app-payload"),Config.extraPayload="",Config.Program="cmd.bat",Config.WorkingDir=getWorkingDirectory(),Config.isSoundEnabled=getSound(),Config.bpp=getBitsPerPixel(),Config.useRangeRequests=getUseRangeRequests(),Config.glext=getGLExtensions(),Config.cpu=getCPU()}function allowParameterOverride(){return Config.urlParams.length>0||ALLOW_PARAM_OVERRIDE_FROM_URL}function getCPU(){var e="";return(e=allowParameterOverride()?"p2"==e?"p2":"p3"==e?"p3":"":"").length>0&&console.log("setting CPU to: "+e),e}function getBitsPerPixel(){var e="";return e=allowParameterOverride()?"8"==e?8:"16"==e?16:"32"==e?32:DEFAULT_BPP:DEFAULT_BPP,console.log("setting BPP to: "+e),e}function getGLExtensions(){var e="";return allowParameterOverride()?e.length>6&&(e.startsWith("%22")&&e.endsWith("%22")||e.startsWith("%27")&&e.endsWith("%27")?e='"'+(e=(e=e.substring(3,e.length-3)).split("%20").join(" "))+'"':console.log("glext paramater must be in quoted string")):e="",e.length>0&&console.log("setting glext to: "+e),e}function getAutoRun(){var e="";return!(e=allowParameterOverride()?"true"==e||"false"!=e&&DEFAULT_AUTO_RUN:DEFAULT_AUTO_RUN)&&Config.isRunningInline&&(console.log("parameter mismatch. Auto run can't be false if running inline. Resetting auto run to true"),e=!0),console.log("setting auto run to: "+e),e}function getPayload(e){var t="";return allowParameterOverride()||(t=""),t}function getUseRangeRequests(){var e="";return allowParameterOverride()&&e==ONDEMAND_ROOT||(e=ONDEMAND_DEFAULT),console.log("setting ondemand to: "+e),e}function getSound(){var e="";return e=allowParameterOverride()?"true"==e||"false"!=e&&DEFAULT_SOUND_ENABLED:DEFAULT_SOUND_ENABLED,console.log("setting sound to: "+e),e}function getWorkingDirectory(){var e="";return e.startsWith("c:/")?(e="/home/username/.wine/dosdevices/c:/"+e.substring(3),console.log("setting working directory to: "+e)):e.startsWith("d:/")?(e="/home/username/.wine/dosdevices/d:/"+e.substring(3),console.log("setting working directory to: "+e)):console.log("unable to set work directory"),e}function getAppZipFile(e){var t="";return allowParameterOverride()&&""!==t?(t.endsWith(".zip")||(t+=".zip"),console.log("setting "+e+" zip file to: "+t)):(t="",console.log("not setting "+e+" zip file")),t}function getRootZipFile(e){var t="";return allowParameterOverride()&&""!==t?t.endsWith(".zip")||(t+=".zip"):t=DEFAULT_ROOT_ZIP_FILE,console.log("setting "+e+" zip file to: "+t),t}function getZipFileList(e){var t=[];if(Config.isRunningInline){let e="";e.length>0&&(e.endsWith(".zip")||(e+=".zip"),t.push(e))}if(allowParameterOverride()&&""!==i){if("".length>0)for(var n="".split(";"),r=0;r<n.length;r++){var i=n[r];i.endsWith(".zip")||(i+=".zip"),t.push(i)}}else console.log("not setting "+e+" zip file(s)");return t.length>0&&console.log("setting "+e+" zip file(s) to: "+t),t}function auth_callback(e){if(e)alert("Authentication error: "+e);else if(client.isAuthenticated()){if(alreadyBuiltFileSystem)return;alreadyBuiltFileSystem=!0,document.getElementById("startbtn").disabled=!0,document.getElementById("startbtn").textContent="Syncing...",console.log("authenticated!"),buildFileSystem(new BrowserFS.FileSystem.InMemory,!0)}else alert("unable to authenticate")}function dropboxLogin(){(client=new Dropbox.Client({key:DROPBOX_APP_KEY})).authDriver(new Dropbox.AuthDriver.Popup({receiverUrl:RECEIVE_URL})),client.authenticate(auth_callback),document.getElementById("startbtn").textContent="Start"}function initFileSystem(){var e;(console.log("Use Storage mode: "+Config.storageMode),Config.storageMode===STORAGE_LOCAL_STORAGE)?(BrowserFS.FileSystem.LocalStorage.isAvailable?e=new BrowserFS.FileSystem.LocalStorage:(e=new BrowserFS.FileSystem.InMemory,console.log("Switching to In Memory store as LocalStorage is not available")),buildFileSystem(e,!1)):buildFileSystem(new BrowserFS.FileSystem.InMemory,!1)}function syncGet(e,t,n){let r=new XMLHttpRequest;r.open("GET",Config.locateRootBaseUrl+e,!1);let i=null,o=null;r.overrideMimeType("text/plain; charset=x-user-defined");let l="bytes="+t+"-"+(t+n-1);if(r.setRequestHeader("Range",l),r.onreadystatechange=function(e){if(4!==r.readyState);else{if(200===r.status||206===r.status){const e=r.responseText;i=new Int8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return}o="XHR error."}},r.send(),o)throw o;return i}function getFileSize(e){return new Promise((function(t,n){const r=new XMLHttpRequest;r.open("HEAD",Config.locateRootBaseUrl+e),r.onreadystatechange=function(e){if(4===r.readyState){if(200!==r.status)throw new Error("Unable to get file size");try{t(parseInt(r.getResponseHeader("Content-Length")||"-1",10))}catch(e){throw e}}},r.onerror=function(){n(Error("Network Error"))},r.send()})).then((function(e,t){if(null!=t)throw new Error(t);return e}),(function(e){throw new Error("Something when wrong when getting file size")}))}function getCentralOffset(e){var t=0,n=e.byteLength-22,r=Math.max(0,n-65536),i=0;do{if(n<r)throw new Error("not a zip file?");t=n--,i=e[t++]|e[t++]<<8|(e[t++]|e[t++]<<8)<<16}while(101010256!=i);t=t+10-4;e[t++],e[t++];return t=t+16-12,e[t++]|e[t++]<<8|(e[t++]|e[t++]<<8)<<16}function buildFileSystem(e,t){spinnerElement.style.display="",spinnerElement.hidden=!1;var n=BrowserFS.BFSRequire("buffer").Buffer;buildExtraFileSystems(n,(function(r){buildAppFileSystems((function(i){if(Config.useRangeRequests==ONDEMAND_ROOT)buildRemoteZipFile(Config.rootZipFile,(function(n){buildBrowserFileSystem(e,t,i,r,n)}));else{var o={};o[Config.rootZipFile]=null,BrowserFS.FileSystem.XmlHttpRequest.Create({index:o,baseUrl:Config.locateRootBaseUrl},(function(o,l){o&&console.log(o);var a=new BrowserFS.FileSystem.MountableFileSystem;a.mount("/temp",l),a.readFile("/temp/"+Config.rootZipFile,null,flag_r,(function(o,l){o&&console.log(o),BrowserFS.FileSystem.ZipFS.Create({zipData:new n(l)},(function(n,o){n&&console.log(n),buildBrowserFileSystem(e,t,i,r,o)})),a=null}))}))}}))}))}function buildRemoteZipFile(e,t){var n=BrowserFS.BFSRequire("buffer").Buffer;getFileSize(e).then((function(r){let i=Number(r),o=i>1e5?1e5:i-22,l=syncGet(e,i-o,o),a=getCentralOffset(new Uint8Array(l)),s=syncGet(e,a,i-a);BrowserFS.FileSystem.ZipFS.Create({name:Config.locateRootBaseUrl+e,zipData:new n(s)},(function(e,n){e&&console.log(e),t(n)}))}))}function getBase64Data(e){let t=atob(e),n=t.length;for(var r=new Uint8Array(n),i=0;i<n;i++)r[i]=t.charCodeAt(i);return r}function buildAppFileSystems(e){var t=BrowserFS.BFSRequire("buffer").Buffer;if(Config.appPayload.length>0){let n=getBase64Data(Config.appPayload);BrowserFS.FileSystem.ZipFS.Create({zipData:new t(n)},(function(t,n){t&&console.log(t);let r=new BrowserFS.FileSystem.FolderAdapter("/",n);e(r)}))}else if(Config.appZipFile.length>0){var n={};n[Config.appZipFile]=null;var r=new BrowserFS.FileSystem.MountableFileSystem;BrowserFS.FileSystem.XmlHttpRequest.Create({index:n,baseUrl:Config.locateAppBaseUrl},(function(n,i){n&&console.log(n),r.mount("/temp",i),r.readFile("/temp/"+Config.appZipFile,null,flag_r,(function(n,i){n&&console.log(n),BrowserFS.FileSystem.ZipFS.Create({zipData:new t(i)},(function(t,n){t&&console.log(t);let i=new BrowserFS.FileSystem.FolderAdapter("/",n);e(i),r=null}))}))}))}else{let t=new BrowserFS.FileSystem.FolderAdapter("/",new BrowserFS.FileSystem.InMemory);e(t)}}function buildExtraFileSystems(e,t){var n=[];if(Config.extraPayload.length>0){let r=getBase64Data(Config.extraPayload);BrowserFS.FileSystem.ZipFS.Create({zipData:new e(r)},(function(e,r){e&&console.log(e),n.push(r),t(n)}))}else if(Config.extraZipFiles.length>0)for(let o=0;o<Config.extraZipFiles.length;o++){var r={};r[Config.extraZipFiles[o]]=null;var i=new BrowserFS.FileSystem.MountableFileSystem;BrowserFS.FileSystem.XmlHttpRequest.Create({index:r,baseUrl:Config.locateOverlayBaseUrl},(function(r,l){r&&console.log(r),i.mount("/temp",l),i.readFile("/temp/"+Config.extraZipFiles[o],null,flag_r,(function(r,o){r&&console.log(r),BrowserFS.FileSystem.ZipFS.Create({zipData:new e(o)},(function(e,r){e&&console.log(e),n.push(r),n.length==Config.extraZipFiles.length&&t(n),i=null}))}))}))}else t(n)}function buildBrowserFileSystem(e,t,n,r,i){FS.createPath(FS.root,"root",FS.createPath),FS.createPath("/root","base",!0,!0),FS.createPath("/root","files",!0,!0);BrowserFS.FileSystem.OverlayFS.Create({readable:i,writable:new BrowserFS.FileSystem.InMemory},(function(i,o){i&&console.log(i),SUPPRESS_WINEBOOT&&deleteFile(o,"/lib/wine/wineboot.exe.so"),n.initialize((function(i){i&&console.log(i),BrowserFS.FileSystem.OverlayFS.Create({readable:n,writable:e},(function(e,n){if(e&&console.log(e),t){var i=new BrowserFS.FileSystem.AsyncMirror(n,new BrowserFS.FileSystem.Dropbox(client));i.initialize((function(e){e&&console.log(e),postBuildFileSystem(o,i,r)}))}else postBuildFileSystem(o,n,r)}))}))}))}function postBuildFileSystem(e,t,n){var r=new BrowserFS.FileSystem.MountableFileSystem;r.mount("/root/base",e),r.mount(Config.appDirPrefix.substring(0,Config.appDirPrefix.length-1),t);var i=new BrowserFS.EmscriptenFS;BrowserFS.initialize(r),FS.mount(i,{root:"/root"},"/root");for(let e=0;e<n.length;e++)recursiveCopy(n[e],Config.extraZipFiles[e],"/");if(n=null,Config.showUploadDownload&&(document.getElementById("uploadbtn").style.display="",document.getElementById("downloadbtn").style.display=""),spinnerElement.style.display="none",Config.storageMode===STORAGE_DROPBOX)startEmulator();else if(Config.isAutoRunSet)start();else{var o=document.getElementById("startbtn");o.disabled=!1,o.style.display="";var l=document.getElementById("soundToggle");Config.isSoundEnabled&&(l.checked=!0),document.getElementById("sound-checkbox").style.display=""}}function deleteFile(e,t){try{e.unlinkSync(t)}catch(e){console.log("Unable to delete:"+t+" error:"+e.message)}}function createFolders(e,t){for(var n="",r=0;r<t.length;r++)t[r].length>0&&(n=n+"/"+t[r],e.mkdirSync(n))}function recursiveCopy(e,t,n){var r=null==t?"":"/"+t.substring(0,t.length-4),i=BrowserFS.BFSRequire("path");!function e(t,n,r){createFolderIfNecessary(n,r),t.readdirSync(n).forEach((function(o){var l=i.resolve(n,o);l.startsWith("/__MACOSX")||l.endsWith(".DS_Store")||(t.statSync(l).isDirectory()?e(t,l,r):createFileIfNecessary(t,l,r))}))}(e,n,r)}function createFileIfNecessary(e,t,n){var r=t;t.startsWith(n)&&(t=t.substring(n.length));var i=extractFirstPartOfPath(t);if(i.length>0){var o=extractLastPartOfPath(t),l=e.readFileSync(r,null,flag_r);try{console.log("creating: root/base"+i+"/"+o),FS.createDataFile("root/base"+i,o,l,!0,!0)}catch(e){if("File exists"===e.message||"FS error"===e.message)try{FS.unlink("root/base"+i+"/"+o),FS.createDataFile("root/base"+i,o,l,!0,!0)}catch(e){console.log("file replace error:"+e.message+" for: "+i+"/"+o)}else console.log("file creation error:"+e.message+" for: "+i+"/"+o)}}}function createFolderIfNecessary(e,t){e.startsWith(t)&&(e=e.substring(t.length));var n=extractFirstPartOfPath(e),r=extractLastPartOfPath(e);if(n.length>0)try{FS.lookupPath("/root/base"+n+"/"+r,{follow:!0})}catch(e){if("No such file or directory"==e.message||"FS error"===e.message)try{FS.createPath("/root/base/"+n,r,!0,!0)}catch(e){console.log("Directory creation error:"+e.message+" for: "+n+"/"+r)}else"File exists"!=e.message&&console.log("Directory creation error:"+e.message+" for: "+n+"/"+r)}}function start(){isRunning||(Config.isRunningInline&&(document.getElementById("inline-runbtn").style.display="none",document.getElementById("inline").style.display=""),Config.storageMode===STORAGE_DROPBOX?null!=client&&client.isAuthenticated()?initFileSystem():dropboxLogin():startEmulator())}function startEmulator(){isRunning=!0,document.getElementById("startbtn").style.display="none",document.getElementById("sound-checkbox").style.display="none";for(var e=getEmulatorParams(),t=0;t<e.length;t++)Module.arguments.push(e[t]);document.getElementById("startbtn").textContent="Running...",Module.removeRunDependency("setupBoxedWine")}function loadScreen(){if(Config.isAutoRunSet||Config.isRunningInline){var e=document.getElementById("canvas"),t=e.getContext("2d");t.font="40px Arial",t.textAlign="center",t.fillText("Loading...",e.width/2.5,e.height/2)}}var initialSetup=function(){console.log("running initial setup"),setConfiguration(),Module.addRunDependency("setupBoxedWine"),initFileSystem()};function getExecutable(){var e="";return allowParameterOverride()&&""!==e?((e.startsWith("%22")&&e.endsWith("%22")||e.startsWith("%27")&&e.endsWith("%27"))&&(e=e.substring(3,e.length-3)),e=e.split("%20").join(" "),console.log("setting program to execute to: "+e)):console.log("not setting program to execute"),e}var errorCallback=function(e){console.log(e)},dirCount=0;function getEntriesAsPromise(e,t,n){return new Promise(((r,i)=>{if(e.isDirectory){dirCount+=1;let o=e.createReader(),l=()=>{o.readEntries((e=>{e.length>0?(e.forEach((function(e){getEntriesAsPromise(e,t,n)})),l()):(0==(dirCount-=1)&&(Config.isAutoRunSet||isRunning||loadExeModal(t,n)),r())}),i)};l()}else{let r=e.fullPath,i=r.toUpperCase();n.push(r),(i.endsWith(".EXE")||i.endsWith(".BAT"))&&t.push(r),e.file((function(e){uploadFile(e,r,n)}),errorCallback)}}))}function loadExeModal(e,t){document.getElementById("modalLinkExe").click(),document.getElementById("message").innerHTML="<p>Uploading files...</p>",timer=setInterval((function(){readyCheck(e,t)}),100)}function populateModalExe(e){var t=document.getElementById("items");t.innerHTML="";let n=document.createElement("lu");for(let t=0;t<e.length;t++){let r=e[t],i=document.createElement("li");i.addEventListener("click",(function(e){execute(r)}),!1),i.innerHTML=r,n.appendChild(i)}t.appendChild(n)}function execute(e){document.getElementById("items");document.getElementById("openModalExeClick").click();var t=extractLastPartOfPath(e),n=extractFirstPartOfPath(e);Config.WorkingDir="/home/username/.wine/dosdevices/d:/"+n.substring(1),Config.Program=t,startEmulator()}function readyCheck(e,t){0==t.length&&(clearInterval(timer),document.getElementById("message").innerHTML="")}function isInSubDirectory(e,t){var n=FS.lookupPath(e,{follow:!0});if(null!=n&&n.node.isFolder)for(var r=FS.readdir(e).filter((function(e){return"."!==e&&".."!==e&&"__MACOSX"!==e})),i=0;i<r.length;i++)if(r[i]===t)return!0;return!1}function getEmulatorParams(){var e=["-root","/root/base"];if(e.push("-mount_drive"),e.push(Config.appDirPrefix),e.push("d"),e.push("-nozip"),Config.isSoundEnabled||e.push("-nosound"),Config.bpp!=DEFAULT_BPP&&(e.push("-bpp"),e.push(""+Config.bpp)),Config.cpu.length>0&&e.push("-"+Config.cpu),Config.glext.length>0&&(e.push("-glext"),e.push(Config.glext)),Config.WorkingDir.length>0)e.push("-w"),e.push(Config.WorkingDir);else if(Config.appPayload.length>0&&Config.Program.length>0&&"/"!=Config.Program.substring(0,1))e.push("-w"),e.push("/home/username/.wine/dosdevices/d:");else if(Config.appZipFile.length>0&&Config.Program.length>0&&"/"!=Config.Program.substring(0,1)){var t=Config.appZipFile.substring(0,Config.appZipFile.lastIndexOf("."));e.push("-w"),isInSubDirectory(Config.appDirPrefix,t)?e.push("/home/username/.wine/dosdevices/d:/"+t):e.push("/home/username/.wine/dosdevices/d:")}return e.push("/bin/wine"),Config.Program.length>0?(Config.Program.endsWith(".bat")&&(e.push("cmd"),e.push("/c")),e.push(Config.Program)):(e.push("explorer"),e.push("/desktop=shell")),console.log("Emulator params:"+e),e}var Module={logReadFiles:!1,preRun:[initialSetup],arguments:[],postRun:[],print:function(e){e=Array.prototype.slice.call(arguments).join(" "),console.log(e)},printErr:function(e){e=Array.prototype.slice.call(arguments).join(" "),console.error(e)},canvas:function(){var e=document.getElementById("canvas");return e.addEventListener("webglcontextlost",(function(e){alert("WebGL context lost. You will need to reload the page."),e.preventDefault()}),!1),e.width=800,e.height=600,e}(),setStatus:function(e){if(Module.setStatus.last||(Module.setStatus.last={time:Date.now(),text:""}),e!==Module.setStatus.text){var t=e.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/),n=Date.now();t&&n-Date.now()<30||(t?(e=t[1],progressElement.value=100*parseInt(t[2]),progressElement.max=100*parseInt(t[4]),progressElement.hidden=!1,spinnerElement.hidden=!1):(progressElement.value=null,progressElement.max=null,progressElement.hidden=!0,e||(spinnerElement.hidden=!0)),statusElement.innerHTML=e)}},totalDependencies:0,monitorRunDependencies:function(e){this.totalDependencies=Math.max(this.totalDependencies,e),Module.setStatus(e?"Preparing... ("+(this.totalDependencies-e)+"/"+this.totalDependencies+")":"")}};function isHomeDirectory(e){return e.length>=10&&"/root/home"===e.substring(0,10)}function startWithFiles(e){for(let t=0;t<e.length;t++)uploadFile(e[t])}function uploadFile(e,t,n){let r=null;r=t?t.startsWith("/")?t.substring(1):t:0==e.webkitRelativePath.length?e.name:e.webkitRelativePath;var i=new FileReader;i.file_name=e.name,i.onload=function(){readFile(this.result,r,n)},i.readAsArrayBuffer(e)}function extractLastPartOfPath(e){return e.substring(e.lastIndexOf("/")+1,e.length)}function extractFirstPartOfPath(e){return e.substring(0,e.lastIndexOf("/"))}function extractFilenameExtension(e){return e.substring(e.lastIndexOf(".")+1,e.length)}function extractFilenameWithoutExtension(e){return e.substring(0,e.lastIndexOf("."))}function readFile(e,t,n){if("zip"===extractFilenameExtension(t).toLowerCase()){var r=extractFilenameWithoutExtension(t);if(!createFolder(Config.appDirPrefix,r))return;var i=Config.appDirPrefix+r,o=new JSZip(e);for(var l in o.files){if(null!=(e=o.file(l))){var a=e.asUint8Array();createFile(u=i+"/"+extractFirstPartOfPath(l),p=extractLastPartOfPath(l),a)}else{var s=l.substring(0,l.length-1),u=extractFirstPartOfPath(s),c=extractLastPartOfPath(s);createFolder(u=0==u.length?i:i+"/"+u,c)}}}else{for(var g=!1,d=0,f=Config.appDirPrefix,p=extractLastPartOfPath(t);!g;){var m=t.indexOf("/",d);if(-1==m)g=!0;else{var h=t.substring(d,m),y=f+h;h.length>0&&(null==uniqueDirs[y]&&h.length>0&&(createFolder(f,h),uniqueDirs[y]=""),f=f+h+"/"),d=m+1}}createFile(f.substring(0,f.length-1),p,new Uint8Array(e)),n&&n.pop(t)}}function calcBackupFilename(){var e=(new Date).toISOString();return e=".backup."+e.split(":").join(".")}function createFolder(e,t){var n=!0;try{console.log({parent:e,dir:t}),FS.createPath(e,t,!0,!0),console.log("Directory created :"+e+"/"+t)}catch(r){if("File exists"===r.message||"FS error"===r.message)if(console.log("Directory already exists! :"+e+t),confirm("Directory already exists: "+e+t+" continue?"))try{FS.rename(e+t,e+t+calcBackupFilename()),FS.createPath(e,t,!0,!0),console.log("Directory replaced: "+e+t)}catch(r){console.log("eef="+r),n=!1,alert("unable to create folder: "+e+t)}else n=!1;else console.log("ef="+r)}return n}function createFile(e,t,n){if(!e.includes("__MACOSX"))try{FS.createDataFile(e,t,n,!0,!0),console.log("File created :"+e+"/"+t)}catch(r){if("File exists"===r.message||"FS error"===r.message){if(console.log("File already exists!: "+e+t),confirm("File already exists: "+e+"/"+t+" replace?"))try{FS.unlink(e+"/"+t),FS.createDataFile(e,t,n,!0,!0),console.log("File replaced: "+e+t)}catch(n){console.log("ee="+n),alert("unable to create file: "+e+t)}}else console.log("e="+r)}}function toggleSound(){var e=document.getElementById("soundToggle");Config.isSoundEnabled=e.checked}function toggleDirectory(e){var t=document.getElementById(e);null!=t&&("none"==t.style.display?(t.style.display="",document.getElementById(e+"-expand").style.display="none",document.getElementById(e+"-contract").style.display=""):(t.style.display="none",document.getElementById(e+"-expand").style.display="",document.getElementById(e+"-contract").style.display="none"))}function getParameter(e){var t="",n=Config.urlParams,r=n.length>0?"?"+n:window.location.href,i=r.indexOf("?")+1;if(i>0)for(var o=r.substring(i).split("&"),l=0;l<o.length;l++){var a=o[l].split("=");if(a[0]===e){t=a[1];break}}var s=t.lastIndexOf("#");return s>0&&(t=t.substring(0,s)),t}function select(e,t,n){null!=selectedItem&&(selectedItem.style.backgroundColor=""),(selectedItem=document.getElementById(e+"-data")).style.backgroundColor="#94c2c5";var r=t;null!=n&&(r+=n),document.getElementById("selectedItem").value=r,selectedFilename=n}function endsWith(e,t){return-1!==e.indexOf(t,e.length-t.length)}function extract(){null!=url&&window.URL.revokeObjectURL(url);var e=document.getElementById("selectedItem").value;if(null!=e&&e.length>0&&files.length>1){endsWith(e,"/")&&(e=e.substring(0,e.length-1));var t,n=!1;null!=selectedFilename?t=selectedFilename:(n=!0,t=e.substring(e.lastIndexOf("/")+1)+".zip");var r=getFile(e,n);url=window.URL.createObjectURL(r),ae.href=url,ae.download=t,ae.click()}}function done(){null!=url&&window.URL.revokeObjectURL(url)}function leaf(e){return'<tr><td ><span id="'+ ++index+'-data" onclick="select('+index+",'"+e.dir+"','"+e.filename+"')\">"+e.filename+"</span></td></tr>"}function branch(e){var t=e[index];index++;var n=t.dir,r=n.substring(0,n.length-1);r=r.substring(r.lastIndexOf("/")+1,r.length);var i="<tr>";for(i=(i=(i=(i=(i+="<td>")+'<span id="'+index+'-expand"><a onclick="toggleDirectory(\''+index+"')\"><strong>+</strong></a></span>")+'<span id="'+index+'-contract" style="display:none;"><a onclick="toggleDirectory(\''+index+"')\"><strong>-</strong></a></span>")+'<span id="'+index+'-data" onclick="select('+index+",'"+n+"', null)\">["+r+"]</span>")+"<div id='"+index+'\' style="display:none;">',i+="<table>";index<e.length;){var o=e[index];if(o.dir===t.dir)i+=leaf(o);else{if(parentDir(o.dir)!==t.dir)break;i+=branch(e,index)}}return i+="</table>",i+="</div>",i+="</td>",i+="</tr>"}function parentDir(e){return endsWith(e,"/")&&(e=e.substring(0,e.length-1)),e.substring(0,e.lastIndexOf("/")+1)}function buildTree(){document.getElementById("modalLink").click();var e=document.getElementById("tree");document.getElementById("selectedItem").value="",selectedFilename=null,files=[],e.innerHTML="",index=0,readFiles(Config.appDirPrefix,files);var t="<table>";t+=branch(files),t+="</table>",document.getElementById("loadStatus").style.display="none",e.innerHTML=t,toggleDirectory("1")}function readFiles(e,t){console.log("adding directory: "+e),t.push({dir:e,filename:""}),FS.readdir(e).filter((function(e){return"."!==e&&".."!==e})).forEach((function(n){FS.lookupPath(e+n,{follow:!0}).node.isFolder?readFiles(e+n+"/",t):(console.log("adding file: "+e+n),t.push({dir:e,filename:n}))}))}function startsWith(e,t){return e.slice(0,t.length)==t}function getFile(e,t){if(t){var n=new JSZip;return files.forEach((function(t){if(startsWith(t.dir,e))if(""!==t.filename){var r=t.dir+t.filename,i=FS.readFile(r,{encoding:"binary"});n.file(r.substring(e.length),i)}else n.file(t.dir.substring(e.length),null,{dir:!0})})),n.generate({type:"blob",compression:"DEFLATE"})}var r=FS.readFile(e,{encoding:"binary"});return new Blob([r],{type:"octet/stream"})}Module.setStatus("Downloading..."),window.onerror=function(){Module.setStatus("Exception thrown, see JavaScript console"),spinnerElement.style.display="none",Module.setStatus=function(e){e&&Module.printErr("[post-exception status] "+e)}};
//# sourceMappingURL=boxedwine-shell.js.map
