{"version":3,"sources":["boxedwine-shell.js"],"names":["ALLOW_PARAM_OVERRIDE_FROM_URL","SUPPRESS_WINEBOOT","ROOT","STORAGE_DROPBOX","STORAGE_LOCAL_STORAGE","STORAGE_MEMORY","ONDEMAND_DEFAULT","ONDEMAND_ROOT","DROPBOX_APP_KEY","RECEIVE_URL","DEFAULT_AUTO_RUN","DEFAULT_SOUND_ENABLED","DEFAULT_APP_DIRECTORY","DEFAULT_BPP","DEFAULT_ROOT_ZIP_FILE","Config","locateRootBaseUrl","locateAppBaseUrl","locateOverlayBaseUrl","urlParams","storageMode","isRunningInline","showUploadDownload","selectedItem","selectedFilename","isRunning","uniqueDirs","timer","index","files","client","alreadyBuiltFileSystem","ae","document","createElement","body","appendChild","style","fileFS","url","statusElement","getElementById","progressElement","spinnerElement","flag_r","isReadable","isWriteable","isTruncating","isAppendable","isSynchronous","isExclusive","pathExistsAction","pathNotExistsAction","setConfiguration","appDirPrefix","isAutoRunSet","getAutoRun","rootZipFile","extraZipFiles","appZipFile","appPayload","getPayload","extraPayload","Program","WorkingDir","getWorkingDirectory","isSoundEnabled","getSound","bpp","getBitsPerPixel","useRangeRequests","getUseRangeRequests","glext","getGLExtensions","cpu","getCPU","allowParameterOverride","length","console","log","startsWith","endsWith","substring","split","join","auto","param","payload","ondemand","soundEnabled","dir","getAppZipFile","filename","getRootZipFile","getZipFileList","zipFiles","ondemandMinOverlay","push","zipFilenames","i","auth_callback","error","alert","isAuthenticated","disabled","textContent","buildFileSystem","BrowserFS","FileSystem","InMemory","dropboxLogin","Dropbox","Client","key","authDriver","AuthDriver","Popup","receiverUrl","authenticate","initFileSystem","writableStorage","LocalStorage","isAvailable","syncGet","offset","req","XMLHttpRequest","open","data","err","overrideMimeType","range","setRequestHeader","onreadystatechange","e","readyState","status","text","responseText","Int8Array","charCodeAt","send","getFileSize","p","Promise","resolve","reject","Error","parseInt","getResponseHeader","onerror","then","result","getCentralOffset","buffer","pos","byteLength","top","Math","max","isDropBox","display","hidden","Buffer","BFSRequire","buildExtraFileSystems","extraFSs","buildAppFileSystems","homeAdapter","buildRemoteZipFile","zipfs","buildBrowserFileSystem","rootListingObject","XmlHttpRequest","Create","baseUrl","e2","xmlHttpFs","rootMfs","MountableFileSystem","mount","readFile","contents","ZipFS","zipData","e3","zipFilename","zipFileCallback","fileSizeAsString","fileSizeAsInt","Number","blockSize","lastPartOfFile","centralOffset","Uint8Array","name","getBase64Data","base64Data","bytes","atob","contentLength","adapterCallback","e4","additionalZipfs","FolderAdapter","listingObject","mfs","fsCallback","FS","createPath","root","OverlayFS","readable","writable","rootOverlay","deleteFile","initialize","homeOverlay","mirrorFS","AsyncMirror","postBuildFileSystem","rootFS","homeFS","BFS","EmscriptenFS","recursiveCopy","startEmulator","start","startBtn","soundToggle","checked","fs","pathAndFilename","unlinkSync","ef","message","createFolders","mainfs","folders","directory","k","mkdirSync","prefix","path","copyDirectory","createFolderIfNecessary","readdirSync","forEach","item","file","statSync","isDirectory","createFileIfNecessary","fullPath","parent","extractFirstPartOfPath","extractLastPartOfPath","readFileSync","createDataFile","unlink","lookupPath","follow","cef","params","getEmulatorParams","Module","loadScreen","canvas","ctx","getContext","font","textAlign","fillText","width","height","initialSetup","getExecutable","prog","errorCallback","dirCount","getEntriesAsPromise","exeFiles","allFiles","reader","createReader","doBatch","readEntries","entries","entry","loadExeModal","uppercase","toUpperCase","uploadFile","click","innerHTML","setInterval","readyCheck","populateModalExe","listElement","element","addEventListener","event","execute","clearInterval","isInSubDirectory","programDir","fileEntry","node","isFolder","readdir","filter","idx","subDirectory","lastIndexOf","logReadFiles","preRun","arguments","postRun","print","Array","prototype","slice","call","printErr","preventDefault","setStatus","last","time","Date","now","m","match","value","totalDependencies","monitorRunDependencies","left","this","isHomeDirectory","str","startWithFiles","webkitRelativePath","filereader","FileReader","file_name","onload","readAsArrayBuffer","extractFilenameExtension","extractFilenameWithoutExtension","toLowerCase","filenameNoExt","createFolder","zipDirPrefix","zip","JSZip","buf","asUint8Array","createFile","done","startIndex","base","dirIndex","indexOf","dirName","pop","calcBackupFilename","toISOString","created","confirm","rename","eef","includes","ee","toggleSound","el","toggleDirectory","itemWidget","getParameter","inputKey","retVal","replacementParameters","window","location","href","x","kv","hashIndex","select","backgroundColor","fullpath","suffix","extract","URL","revokeObjectURL","outputFilename","blob","getFile","createObjectURL","download","leaf","branch","nextItem","parentDir","childDir","buildTree","readFiles","currentDir","eachFile","fileLocation","encoding","generate","type","compression","Blob"],"mappings":"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","file":"boxedwine-shell.js","sourcesContent":["        let ALLOW_PARAM_OVERRIDE_FROM_URL = false;\n        let SUPPRESS_WINEBOOT = true; //prevent wine from re-creating .wine directory\n        let ROOT = \"/root\";\n        let STORAGE_DROPBOX = \"DROPBOX\";\n        let STORAGE_LOCAL_STORAGE = \"LOCAL_STORAGE\";\n        let STORAGE_MEMORY = \"MEMORY\";\n\n        let ONDEMAND_DEFAULT = \"notset\";\n        let ONDEMAND_ROOT = \"root\";\n\n        let DROPBOX_APP_KEY = 'put key in here';\n        let RECEIVE_URL = \"http://put url in here/oauth_receiver.html\";\n\n        let DEFAULT_AUTO_RUN = true;\n        let DEFAULT_SOUND_ENABLED = true;\n        let DEFAULT_APP_DIRECTORY = ROOT + \"/files/\";\n        let DEFAULT_BPP = 32;\n        let DEFAULT_ROOT_ZIP_FILE = \"boxedwine.zip\";\n        //params\n        let Config = {};\n        Config.locateRootBaseUrl = \"\";\n        Config.locateAppBaseUrl = \"\";\n        Config.locateOverlayBaseUrl = \"\";\n        Config.urlParams = \"\";\n        Config.storageMode = STORAGE_LOCAL_STORAGE;\n        Config.isRunningInline = false;\n        Config.showUploadDownload = false;\n\n        var isRunning = false;\n        var uniqueDirs = {};\n        var timer = null;\n        var index = 0;\n        var selectedItem;\n        var selectedFilename;\n        var files = []; //used for constructing tree and for retrieving files when zipping\n        var client = null;\n        var alreadyBuiltFileSystem = false;\n\n        var ae = document.createElement(\"a\");\n        document.body.appendChild(ae);\n        ae.style = \"display: none\";\n        var url = null;\n          var statusElement = document.getElementById('status');\n          var progressElement = document.getElementById('progress');\n          var spinnerElement = document.getElementById('spinner');\n  //      var dropzone = document.getElementById(\"dropzone\");\n\n  var fileFS;\n\n    //recursive copy based on code in emularity github project\n    var flag_r = { isReadable: function() { return true; },\n        isWriteable: function() { return false; },\n        isTruncating: function() { return false; },\n        isAppendable: function() { return false; },\n        isSynchronous: function() { return false; },\n        isExclusive: function() { return false; },\n        pathExistsAction: function() { return 0; },\n        pathNotExistsAction: function() { return 1; }\n    };\n        function setConfiguration() {\n            Config.appDirPrefix = DEFAULT_APP_DIRECTORY;\n            Config.isAutoRunSet = getAutoRun();\n            //Modified to launch wineconsole \n            //cull unused functions in future!\n            Config.rootZipFile = \"boxedwine.zip\"//getRootZipFile(\"root\"); //MANUAL:\"base.zip\";\n            Config.extraZipFiles = \"\"; //getZipFileList(\"overlay\"); //MANUAL:\"dlls.zip;fonts.zip\";\n            Config.appZipFile = \"assembler.zip\"//getAppZipFile(\"app\"); //MANUAL:\"chomp.zip\";\n            Config.appPayload = getPayload(\"app-payload\"); \n            Config.extraPayload = \"\"//getPayload(\"overlay-payload\"); \n            Config.Program = \"cmd.bat\";//getExecutable(); //MANUAL:\"CHOMP.EXE\";\n            //end\n            Config.WorkingDir = getWorkingDirectory(); //MANUAL:\"\";\n            Config.isSoundEnabled = getSound();\n            Config.bpp = getBitsPerPixel();\n            Config.useRangeRequests = getUseRangeRequests();\n            Config.glext = getGLExtensions();\n            Config.cpu = getCPU();\n        }\n        function allowParameterOverride() {\n            if(Config.urlParams.length >0) {\n                return true;\n            }\n            return ALLOW_PARAM_OVERRIDE_FROM_URL;\n        }\n        function getCPU(){\n            var cpu = \"\";//getParameter(\"cpu\");\n            if(!allowParameterOverride()){\n                cpu = \"\";\n            }else if(cpu == \"p2\") {\n                cpu = \"p2\";\n            }else if(cpu == \"p3\") {\n                cpu = \"p3\";\n            }else{\n                cpu = \"\";\n            }\n            if(cpu.length > 0) {\n                console.log(\"setting CPU to: \"+cpu);\n            }\n            return cpu;\n        }\n        function getBitsPerPixel(){\n\n            var bpp = \"\";// getParameter(\"bpp\");\n            if(!allowParameterOverride()){\n                bpp = DEFAULT_BPP;\n            }else if(bpp == \"8\") {\n                bpp = 8;\n            }else if(bpp == \"16\") {\n                bpp = 16;\n            }else if(bpp == \"32\"){\n                bpp = 32;\n            }else{\n                bpp = DEFAULT_BPP;\n            }\n            console.log(\"setting BPP to: \"+bpp);\n            return bpp;\n        }\n        function getGLExtensions(){ //GL not yet available from JS\n            var glext = \"\"; //getParameter(\"glext\");\n            if(!allowParameterOverride()){\n                glext = \"\";\n            }else{\n                if(glext.length > 6) {\n                    if( (glext.startsWith(\"%22\") && glext.endsWith(\"%22\") )\n                        || (glext.startsWith('%27') && glext.endsWith('%27'))){\n                        glext = glext.substring(3, glext.length - 3);\n                        glext = glext.split('%20').join(' ');\n                        glext = '\"' + glext +  '\"';\n                    }else{\n                        console.log(\"glext paramater must be in quoted string\");\n                    }\n                }\n            }\n            if(glext.length > 0) {\n                console.log(\"setting glext to: \"+glext);\n            }\n            return glext;\n        }\n        function getAutoRun(){\n            //No  URL parsing needed\n            var auto =\"\";  //getParameter(\"auto\");\n            if(!allowParameterOverride()){\n                auto = DEFAULT_AUTO_RUN;\n            }else if(auto == \"true\") {\n                auto = true;\n            }else if(auto == \"false\"){\n                auto = false;\n            }else{\n                auto = DEFAULT_AUTO_RUN;\n            }\n            if(!auto && Config.isRunningInline){\n                console.log(\"parameter mismatch. Auto run can't be false if running inline. Resetting auto run to true\");\n                auto = true;\n            }\n            console.log(\"setting auto run to: \"+auto);\n            return auto;\n        }\n        function getPayload(param) {\n            var payload =  \"\";//getParameter(param);\n            if(!allowParameterOverride()){\n                payload = \"\";\n            }\n            return payload;\n        }\n        function getUseRangeRequests(){\n            //No need to parse URL\n            var ondemand = \"\"; // getParameter(\"ondemand\");\n            \n            if(!allowParameterOverride()){\n                ondemand = ONDEMAND_DEFAULT;\n            }else if(ondemand == ONDEMAND_ROOT) {\n            }else{\n                ondemand = ONDEMAND_DEFAULT;\n            }\n            console.log(\"setting ondemand to: \"+ondemand);\n            return ondemand;\n        }\n        function getSound(){\n            //No need to parse URL\n            var soundEnabled = \"\";// getParameter(\"sound\");\n            if(!allowParameterOverride()){\n                soundEnabled = DEFAULT_SOUND_ENABLED;\n            }else if(soundEnabled == \"true\") {\n                soundEnabled = true;\n            }else if(soundEnabled == \"false\"){\n                soundEnabled = false;\n            }else{\n                soundEnabled = DEFAULT_SOUND_ENABLED;\n            }\n            console.log(\"setting sound to: \"+soundEnabled);\n            return soundEnabled;\n        }\n        function getWorkingDirectory(){\n            var dir = \"\";\n            //no need to parse URL\n            /*\n            var dir =  getParameter(\"work\");\n            if(!allowParameterOverride() || dir===\"\"){\n                dir = \"\";\n            }else{\n                */\n                if(dir.startsWith('c:/')){\n                    dir = \"/home/username/.wine/dosdevices/c:/\" + dir.substring(3);\n                    console.log(\"setting working directory to: \"+dir);\n                }else if(dir.startsWith('d:/')){\n                    dir = \"/home/username/.wine/dosdevices/d:/\" + dir.substring(3);\n                    console.log(\"setting working directory to: \"+dir);\n                }else{\n                    console.log(\"unable to set work directory\");\n                }\n           // }\n            return dir;\n        }\n\n        function getAppZipFile(param){\n\n            var filename = \"\"; //getParameter(param);\n            if(!allowParameterOverride() || filename===\"\"){\n                filename = \"\";\n                console.log(\"not setting \" + param + \" zip file\");\n            }else{\n                if(!filename.endsWith(\".zip\")){\n                    filename = filename + \".zip\";\n                }\n                console.log(\"setting \" + param + \" zip file to: \"+filename);\n            }\n            return filename;\n        }\n\n        //Not needed\n        function getRootZipFile(param){\n\n            var filename = \"\"; //getParameter(param);\n            if(!allowParameterOverride() || filename===\"\"){\n                filename = DEFAULT_ROOT_ZIP_FILE;\n            }else{\n                if(!filename.endsWith(\".zip\")){\n                    filename = filename + \".zip\";\n                }\n            }\n            console.log(\"setting \" + param + \" zip file to: \"+filename);\n\n            return filename;\n        }\n        function getZipFileList(param){\n            var zipFiles = [];\n            if(Config.isRunningInline) {\n                let ondemandMinOverlay = \"\";// getParameter(\"inline-default-ondemand-root-overlay\");\n                if(ondemandMinOverlay.length > 0) {\n                    if(!ondemandMinOverlay.endsWith(\".zip\")){\n                        ondemandMinOverlay = ondemandMinOverlay + \".zip\";\n                    }\n                    zipFiles.push(ondemandMinOverlay);\n                }\n            }\n            var filenames =  \"\"//getParameter(param);\n            if(!allowParameterOverride() || filename===\"\"){\n                console.log(\"not setting \" + param + \" zip file(s)\");\n            }else{\n                if(filenames.length > 0) {\n                    var zipFilenames = filenames.split(';');\n                    for(var i=0; i < zipFilenames.length;i++) {\n                        var filename = zipFilenames[i];\n                        if(!filename.endsWith(\".zip\")){\n                            filename = filename + \".zip\";\n                        }\n                        zipFiles.push(filename);\n                    }\n                }\n            }\n            if(zipFiles.length > 0) {\n                console.log(\"setting \" + param + \" zip file(s) to: \"+zipFiles);\n            }\n            return zipFiles;\n        }\n        function auth_callback(error) {\n            if (error) {\n                alert('Authentication error: ' + error);\n                return;\n            }\n            if (client.isAuthenticated()) {\n                if(alreadyBuiltFileSystem){\n                    return;\n                }\n                alreadyBuiltFileSystem = true;\n                document.getElementById('startbtn').disabled = true;\n                document.getElementById('startbtn').textContent = \"Syncing...\";\n                console.log(\"authenticated!\");\n                buildFileSystem(new BrowserFS.FileSystem.InMemory(), true);\n            } else {\n                alert('unable to authenticate');\n            }\n        }\n        function dropboxLogin()\n        {\n            client = new Dropbox.Client({key: DROPBOX_APP_KEY});\n            client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl: RECEIVE_URL}));\n            client.authenticate(auth_callback);\n            document.getElementById('startbtn').textContent = \"Start\";\n        }\n        function initFileSystem()\n        {\n            console.log(\"Use Storage mode: \"+Config.storageMode);\n            if(Config.storageMode === STORAGE_LOCAL_STORAGE){\n                var writableStorage;\n                if(BrowserFS.FileSystem.LocalStorage.isAvailable){\n                    writableStorage = new BrowserFS.FileSystem.LocalStorage();\n                }else{\n                    writableStorage = new BrowserFS.FileSystem.InMemory();\n                    console.log(\"Switching to In Memory store as LocalStorage is not available\");\n                }\n                buildFileSystem(writableStorage, false);\n            //not using drop box\n            //}else if(Config.storageMode === STORAGE_DROPBOX){\n            //    client.authenticate({interactive:false}, auth_callback);\n            }else{\n                buildFileSystem(new BrowserFS.FileSystem.InMemory(), false);\n            }\n        }\n        //function from browserfs\n        function syncGet(url, offset, length)\n        {\n          let req = new XMLHttpRequest();\n          req.open('GET', Config.locateRootBaseUrl + url, false);\n          let data = null;\n          let err = null;\n          // Classic hack to download binary data as a string.\n          req.overrideMimeType('text/plain; charset=x-user-defined');\n          let end = offset + length - 1;\n          let range = \"bytes=\" + offset + \"-\" + end;\n          req.setRequestHeader('Range', range);\n          req.onreadystatechange = function(e) {\n            if (req.readyState === 4) {\n              if (req.status === 200 || req.status === 206) {\n                    // Convert the text into a buffer.\n                    const text = req.responseText;\n                    data = new Int8Array(text.length);\n                    // Throw away the upper bits of each character.\n                    for (let i = 0; i < text.length; i++) {\n                      // This will automatically throw away the upper bit of each\n                      // character for us.\n                      data[i] = text.charCodeAt(i);\n                    }\n                    return;\n              } else {\n                err = \"XHR error.\";\n                return;\n              }\n            }\n          };\n          req.send();\n          if (err) {\n            throw err;\n          }\n          return data;\n        }\n        function getFileSize(p  )\n        {\n            return new Promise(function(resolve, reject) {\n                  const req = new XMLHttpRequest();\n                  req.open('HEAD', Config.locateRootBaseUrl + p);\n                  req.onreadystatechange = function(e) {\n                    if (req.readyState === 4) {\n                      if (req.status === 200) {\n                        try {\n                          resolve(parseInt(req.getResponseHeader('Content-Length') || '-1', 10));\n                        } catch (e) {\n                          throw e;\n                        }\n                      } else {\n                        throw new Error(\"Unable to get file size\");\n                      }\n                    }\n                  };\n                  req.onerror = function() {\n                      reject(Error(\"Network Error\"));\n                  };\n                  req.send();\n              }).then(function(result, err) {\n                  if (err != null) {\n                      throw new Error(err);\n                  } else {\n                      return result;\n                  }\n            }, function(err) {\n                  throw new Error(\"Something when wrong when getting file size\");\n            });\n        }\n        function getCentralOffset(buffer)\n        {\n            let ENDSIG = 101010256;\n            let ENDHDR = 22;\n            let ENDTOT = 10;\n            let ENDSIZ = 12;\n            let ENDOFF = 16;\n            let ENDNRD = 4;\n            var pos =0;\n            var offset = buffer.byteLength - ENDHDR;\n            var top = Math.max(0, offset - 65536);\n            var result = 0;\n            do {\n                if (offset < top)\n                    throw new Error(\"not a zip file?\");\n                pos = offset--;\n                result = (((buffer[pos++]) | (buffer[pos++]) << 8) | ((buffer[pos++]) | (buffer[pos++]) << 8) << 16);\n            } while (result != ENDSIG);\n            pos = ( pos + ENDTOT - ENDNRD);\n            var count = ((buffer[pos++]) | (buffer[pos++]) << 8);\n            pos = ( pos + ENDOFF - ENDSIZ);\n            return (((buffer[pos++]) | (buffer[pos++]) << 8) | ((buffer[pos++]) | (buffer[pos++]) << 8) << 16);\n        }\n\n        function buildFileSystem(writableStorage, isDropBox)\n        {\n            spinnerElement.style.display = '';\n            spinnerElement.hidden = false;\n            var Buffer = BrowserFS.BFSRequire('buffer').Buffer;\n            buildExtraFileSystems(Buffer, function(extraFSs) {\n                buildAppFileSystems(function(homeAdapter) {\n                    if(Config.useRangeRequests == ONDEMAND_ROOT) {\n                        buildRemoteZipFile(Config.rootZipFile, function callback(zipfs) {\n                            buildBrowserFileSystem(writableStorage, isDropBox, homeAdapter, extraFSs, zipfs);\n                        });\n                    } else {\n                        var rootListingObject = {};\n                        rootListingObject[Config.rootZipFile] =  null;\n                        BrowserFS.FileSystem.XmlHttpRequest.Create({\"index\":rootListingObject, \"baseUrl\": Config.locateRootBaseUrl}, function(e2, xmlHttpFs){\n                            if(e2){\n                                console.log(e2);\n                            }\n                            var rootMfs = new BrowserFS.FileSystem.MountableFileSystem();\n                            rootMfs.mount('/temp', xmlHttpFs);\n                            rootMfs.readFile('/temp/' + Config.rootZipFile, null, flag_r, function callback(e, contents){\n                                if(e){\n                                    console.log(e);\n                                }\n                                BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e3, zipfs){\n                                    if(e3){\n                                        console.log(e3);\n                                    }\n                                    buildBrowserFileSystem(writableStorage, isDropBox, homeAdapter, extraFSs, zipfs);\n                                });\n                                rootMfs = null;\n                            });\n                        });\n                    }\n                });\n            });\n        }\n\n        function buildRemoteZipFile(zipFilename, zipFileCallback)\n        {\n            var Buffer = BrowserFS.BFSRequire('buffer').Buffer;\n            getFileSize(zipFilename).then(function(fileSizeAsString) {\n                let fileSizeAsInt = Number(fileSizeAsString);\n                let blockSize = fileSizeAsInt > 100000 ? 100000 : fileSizeAsInt - 22;\n                let lastPartOfFile = syncGet(zipFilename, fileSizeAsInt - blockSize, blockSize);\n                let centralOffset = getCentralOffset(new Uint8Array(lastPartOfFile));\n                let remainingLength = fileSizeAsInt - centralOffset;\n                let contents = syncGet(zipFilename, centralOffset, remainingLength);\n                BrowserFS.FileSystem.ZipFS.Create({\"name\": Config.locateRootBaseUrl + zipFilename , \"zipData\":new Buffer(contents)}, function(e3, zipfs){\n                    if(e3){\n                        console.log(e3);\n                    }\n                    zipFileCallback(zipfs);\n                });\n            });\n        }\n        function getBase64Data(base64Data)\n        {\n            let bytes = atob(base64Data);\n            let contentLength = bytes.length;\n            var contents = new Uint8Array(contentLength);\n            for (var i = 0; i < contentLength; i++) {\n                contents[i] = bytes.charCodeAt(i);\n            }\n            return contents;\n        }\n        function buildAppFileSystems(adapterCallback)\n        {\n            var Buffer = BrowserFS.BFSRequire('buffer').Buffer;\n            if(Config.appPayload.length > 0){\n                let contents = getBase64Data(Config.appPayload);\n                BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e4, additionalZipfs){\n                    if(e4){\n                        console.log(e4);\n                    }\n                    let homeAdapter = new BrowserFS.FileSystem.FolderAdapter(\"/\", additionalZipfs);\n                    adapterCallback(homeAdapter);\n                });\n            }else if(Config.appZipFile.length > 0){\n                    var listingObject = {};\n                    listingObject[Config.appZipFile] =  null;\n                    var mfs = new BrowserFS.FileSystem.MountableFileSystem();\n                    BrowserFS.FileSystem.XmlHttpRequest.Create({\"index\":listingObject, \"baseUrl\": Config.locateAppBaseUrl}, function(e2, xmlHttpFs){\n                        if(e2){\n                            console.log(e2);\n                        }\n                        mfs.mount('/temp', xmlHttpFs);\n                        mfs.readFile('/temp/' + Config.appZipFile, null, flag_r, function callback(e, contents){\n                            if(e){\n                                console.log(e);\n                            }\n                            BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e3, additionalZipfs){\n                                if(e3){\n                                    console.log(e3);\n                                }\n                                let homeAdapter = new BrowserFS.FileSystem.FolderAdapter(\"/\", additionalZipfs);\n                                adapterCallback(homeAdapter);\n                                mfs = null;\n                            });\n                        });\n                    });\n            }else{\n                let homeAdapter = new BrowserFS.FileSystem.FolderAdapter(\"/\", new BrowserFS.FileSystem.InMemory());\n                adapterCallback(homeAdapter);\n            }\n        }\n        function buildExtraFileSystems(Buffer, fsCallback)\n        {\n            var extraFSs = [];\n            if(Config.extraPayload.length > 0){\n                let contents = getBase64Data(Config.extraPayload);\n                BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e2, zipfs){\n                    if(e2){\n                        console.log(e2);\n                    }\n                    extraFSs.push(zipfs);\n                    fsCallback(extraFSs);\n                });\n            }else if(Config.extraZipFiles.length > 0){\n                for(let i = 0; i < Config.extraZipFiles.length; i++) {\n                    var listingObject = {};\n                    listingObject[Config.extraZipFiles[i]] =  null;\n                    var mfs = new BrowserFS.FileSystem.MountableFileSystem();\n                    BrowserFS.FileSystem.XmlHttpRequest.Create({\"index\":listingObject, \"baseUrl\": Config.locateOverlayBaseUrl}, function(e2, xmlHttpFs){\n                        if(e2){\n                            console.log(e2);\n                        }\n                        mfs.mount('/temp', xmlHttpFs);\n                        mfs.readFile('/temp/' + Config.extraZipFiles[i], null, flag_r, function(e, contents){\n                            if(e){\n                                console.log(e);\n                            }\n                            BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e3, zipfs){\n                                if(e3){\n                                    console.log(e3);\n                                }\n                                extraFSs.push(zipfs);\n                                if(extraFSs.length == Config.extraZipFiles.length) {\n                                    fsCallback(extraFSs);\n                                }\n                                mfs = null;\n                            });\n                        });\n                    });\n                }\n            }else{\n                fsCallback(extraFSs);\n            }\n        }\n\n        function buildBrowserFileSystem(writableStorage, isDropBox, homeAdapter, extraFSs, zipfs)\n        {\n            FS.createPath(FS.root, 'root', FS.createPath);\n            FS.createPath(\"/root\", 'base', true, true);\n            FS.createPath(\"/root\", 'files', true, true);\n            var mainfs = null;\n\n            BrowserFS.FileSystem.OverlayFS.Create({\"readable\":zipfs,\"writable\":new BrowserFS.FileSystem.InMemory()}, function(e3, rootOverlay){\n                if(e3){\n                    console.log(e3);\n                }\n                if(SUPPRESS_WINEBOOT) {\n                   deleteFile(rootOverlay, \"/lib/wine/wineboot.exe.so\");\n                }\n\n                homeAdapter.initialize(function callback(e){\n                    if(e){\n                        console.log(e);\n                    }\n                    BrowserFS.FileSystem.OverlayFS.Create({\"readable\":homeAdapter,\"writable\":writableStorage}, function(e2, homeOverlay){\n                        if(e2){\n                            console.log(e2);\n                        }\n                        if(isDropBox) {\n                            var mirrorFS = new BrowserFS.FileSystem.AsyncMirror(homeOverlay, new BrowserFS.FileSystem.Dropbox(client));\n                            mirrorFS.initialize(function callback(e4){\n                                if(e4){\n                                    console.log(e4);\n                                }\n                                postBuildFileSystem(rootOverlay, mirrorFS, extraFSs);\n                            });\n                        }else{\n                            postBuildFileSystem(rootOverlay, homeOverlay, extraFSs);\n                        }\n                    });\n                });\n            });\n        }\n        function postBuildFileSystem(rootFS, homeFS, extraFSs)\n        {\n            var mfs = new BrowserFS.FileSystem.MountableFileSystem();\n            mfs.mount('/root/base', rootFS);\n            mfs.mount( Config.appDirPrefix.substring(0, Config.appDirPrefix.length - 1), homeFS);\n            var BFS = new BrowserFS.EmscriptenFS();\n\n            BrowserFS.initialize(mfs);\n            FS.mount(BFS, {root: '/root'}, '/root');\n            \n            for(let i = 0; i < extraFSs.length; i++) {\n                recursiveCopy(extraFSs[i], Config.extraZipFiles[i], '/');\n            }\n            extraFSs = null;\n\n            if(Config.showUploadDownload){\n                document.getElementById('uploadbtn').style.display = \"\";\n                document.getElementById('downloadbtn').style.display = \"\";\n            }\n            spinnerElement.style.display = 'none';\n            if(Config.storageMode === STORAGE_DROPBOX){\n                startEmulator();\n            }else{\n                //toggleConsole();\n                if(Config.isAutoRunSet){\n                    start();\n                }else{\n                    var startBtn = document.getElementById('startbtn');\n                    startBtn.disabled = false;\n                    startBtn.style.display = \"\";\n                    var soundToggle = document.getElementById('soundToggle');\n                    if(Config.isSoundEnabled){\n                        soundToggle.checked = true;\n                    }\n                    document.getElementById('sound-checkbox').style.display = \"\";\n                }\n            }\n        }\n        function deleteFile(fs, pathAndFilename)\n        {\n            try {\n                fs.unlinkSync(pathAndFilename);\n            }catch(ef) {\n                console.log(\"Unable to delete:\" + pathAndFilename + \" error:\" + ef.message);\n            }\n        }\n        function createFolders(mainfs, folders)\n        {\n            var directory = \"\";\n            for(var k = 0; k < folders.length; k++){\n                if(folders[k].length > 0) {\n                    directory = directory + \"/\" + folders[k];\n                    mainfs.mkdirSync(directory);\n                }\n            }\n        }\n        function recursiveCopy(fs, zipFilename, filename) {\n\n            var prefix = zipFilename == null ? \"\" : \"/\" + zipFilename.substring(0, zipFilename.length - 4);\n            var path = BrowserFS.BFSRequire('path');\n            copyDirectory(fs, filename, prefix);\n            function copyDirectory(fs, filename, prefix) {\n                createFolderIfNecessary(filename, prefix);\n                fs.readdirSync(filename).forEach(function(item) {\n                    var file = path.resolve(filename, item);\n                    if(!(file.startsWith(\"/__MACOSX\") || file.endsWith(\".DS_Store\"))) {\n                        if (fs.statSync(file).isDirectory()) {\n                            copyDirectory(fs, file, prefix);\n                        } else {\n                            createFileIfNecessary(fs, file, prefix);\n                        }\n                    }\n                });\n            }\n        }\n        function createFileIfNecessary(fs, fullPath, prefix)\n        {\n            var file = fullPath;\n            if(fullPath.startsWith(prefix)) {\n                fullPath = fullPath.substring(prefix.length);\n            }\n            var parent =  extractFirstPartOfPath(fullPath);\n            if(parent.length > 0){\n                var filename = extractLastPartOfPath(fullPath);\n                var contents = fs.readFileSync(file, null, flag_r);\n                try {\n                    console.log(\"creating: root/base\" + parent + \"/\" + filename);\n                    FS.createDataFile(\"root/base\" + parent, filename, contents, true, true);\n                }catch(ef) {\n                    if(ef.message === \"File exists\" || ef.message === \"FS error\"){\n                        try {\n                            FS.unlink(\"root/base\" + parent + \"/\" + filename);\n                            FS.createDataFile(\"root/base\" + parent, filename, contents, true, true);\n                        }catch(ef) {\n                            console.log(\"file replace error:\" + ef.message + \" for: \" + parent + \"/\" + filename);\n                        }\n                    }else {\n                        console.log(\"file creation error:\" + ef.message + \" for: \" + parent + \"/\" + filename);\n                    }\n                }\n            }\n        }\n        //todo use stat!\n        function createFolderIfNecessary(fullPath, prefix)\n        {\n\n            if(fullPath.startsWith(prefix)) {\n                fullPath = fullPath.substring(prefix.length);\n            }\n            var parent = extractFirstPartOfPath(fullPath);\n            var dir = extractLastPartOfPath(fullPath);\n            if(parent.length > 0){\n                try{\n                    FS.lookupPath(\"/root/base\" + parent + \"/\" + dir, { follow: true });\n                }catch(ef){\n                    if(ef.message == \"No such file or directory\"  || ef.message === \"FS error\") {\n                        try{\n                            FS.createPath(\"/root/base/\" + parent, dir, true, true);\n                        }catch(cef) {\n                            console.log(\"Directory creation error:\" + cef.message + \" for: \" + parent + \"/\" + dir);\n                        }\n                    }else if(ef.message != \"File exists\"){\n                        console.log(\"Directory creation error:\" + ef.message+\" for: \" + parent + \"/\" +  dir);\n                    }\n                }\n            }\n        }\n        function start(){\n            if(isRunning){\n                return;\n            }\n            if(Config.isRunningInline) {\n                document.getElementById('inline-runbtn').style.display = 'none';\n                document.getElementById('inline').style.display = \"\";\n            }\n            if(Config.storageMode === STORAGE_DROPBOX){\n                if(client == null || !client.isAuthenticated()){\n                    dropboxLogin();\n                }else{\n                    initFileSystem();\n                }\n            }else{\n                startEmulator();\n            }\n        }\n        function startEmulator()\n        {\n            isRunning = true;\n\n            document.getElementById('startbtn').style.display = 'none';\n            document.getElementById('sound-checkbox').style.display = 'none';\n\n            var params = getEmulatorParams();\n            for(var i=0; i < params.length; i++) {\n                Module['arguments'].push(params[i]);\n            }\n\n            document.getElementById('startbtn').textContent = \"Running...\";\n            Module[\"removeRunDependency\"](\"setupBoxedWine\");\n        }\n        function loadScreen() {\n            if(Config.isAutoRunSet || Config.isRunningInline) {\n                var canvas = document.getElementById(\"canvas\");\n                var ctx = canvas.getContext(\"2d\");\n                ctx.font = \"40px Arial\";\n                ctx.textAlign = \"center\";\n                ctx.fillText(\"Loading...\", canvas.width/2.5, canvas.height/2);\n            }\n        }\n        var initialSetup = function(){\n            console.log(\"running initial setup\");\n            setConfiguration();\n            //loadScreen();\n\n            Module[\"addRunDependency\"](\"setupBoxedWine\");\n            initFileSystem();\n\n            /* //Not using drop box\n            if(Config.storageMode === STORAGE_DROPBOX){\n                startBtn.textContent = \"Login\";\n                startBtn.disabled = false;\n                startBtn.style.display = \"\";\n            }else{\n                initFileSystem();\n            }\n            */\n        }\n\n        function getExecutable()\n        {\n            var prog =  \"\";//getParameter(\"p\");\n            if(!allowParameterOverride() || prog===\"\"){\n                console.log(\"not setting program to execute\");\n            }else{\n                if(prog.startsWith(\"%22\") && prog.endsWith(\"%22\")){\n                    prog = prog.substring(3, prog.length - 3);\n                }else if(prog.startsWith('%27') && prog.endsWith('%27')){\n                    prog = prog.substring(3, prog.length - 3);\n                }\n                prog = prog.split('%20').join(' ');\n                console.log(\"setting program to execute to: \"+prog);\n            }\n            return prog;\n        }\n        var errorCallback = function(e){\n            console.log(e);\n        }\n        var dirCount = 0;\n        function getEntriesAsPromise(item, exeFiles, allFiles) {\n            return new Promise((resolve, reject) => {\n                if(item.isDirectory){\n                    dirCount = dirCount + 1;\n                    let reader = item.createReader();\n                    let doBatch = () => {\n                        reader.readEntries(entries => {\n                            if (entries.length > 0) {\n                                entries.forEach(function(entry){\n                                    getEntriesAsPromise(entry, exeFiles, allFiles);\n                                });\n                                doBatch();\n                            } else {\n                                dirCount = dirCount - 1;\n                                if(dirCount == 0){\n                                    if(!Config.isAutoRunSet && !isRunning){\n                                        loadExeModal(exeFiles, allFiles);\n                                    }\n                                }\n                                resolve();\n                            }\n                        }, reject);\n                    };\n                    doBatch();\n                }else{\n                    let fullPath = item.fullPath;\n                    let uppercase = fullPath.toUpperCase();\n                    allFiles.push(fullPath);\n                    if(uppercase.endsWith(\".EXE\") || uppercase.endsWith(\".BAT\")){\n                        exeFiles.push(fullPath);\n                    }\n                    item.file(function(item){uploadFile(item, fullPath, allFiles);}, errorCallback);\n                }\n            });\n        }\n        function loadExeModal(exeFiles, allFiles)\n        {\n            document.getElementById('modalLinkExe').click();\n            var message = document.getElementById('message');\n            message.innerHTML = \"<p>Uploading files...</p>\";\n            timer = setInterval(function(){readyCheck(exeFiles, allFiles);}, 100);\n        }\n        function populateModalExe(exeFiles)\n        {\n            var root = document.getElementById('items');\n            root.innerHTML = '';\n            let listElement = document.createElement(\"lu\");\n            for(let i = 0; i < exeFiles.length; i++) {\n                let fullPath = exeFiles[i];\n                let element = document.createElement(\"li\");\n                element.addEventListener(\"click\", function(event){execute(fullPath);}, false);\n                element.innerHTML = fullPath;\n                listElement.appendChild(element);\n            }\n            root.appendChild(listElement);\n        }\n        function execute(filename)\n        {\n            var root = document.getElementById('items');\n            document.getElementById('openModalExeClick').click();\n\n            var file = extractLastPartOfPath(filename);\n            var path = extractFirstPartOfPath(filename);\n\n            Config.WorkingDir = \"/home/username/.wine/dosdevices/d:/\" + path.substring(1);\n            Config.Program = file;\n\n            startEmulator();\n        }\n        function readyCheck(exeFiles, allFiles)\n        {\n            if(allFiles.length==0){\n                clearInterval(timer);\n                var message = document.getElementById('message');\n                message.innerHTML = '';\n                //populateModalExe(exeFiles);\n            }\n        }\n       // dropzone.addEventListener(\"dragover\", function(event){\n       //     event.preventDefault();\n       // }, false);\n       // dropzone.addEventListener(\"drop\", function(event){\n       //     event.preventDefault();\n       //     //if only i know something about async\n       //     let items = event.dataTransfer.items;\n       //     let exeFiles = [];\n       //     let allFiles = [];\n       //     for(let i =0; i < items.length; i++){\n       //         getEntriesAsPromise(items[i].webkitGetAsEntry(), exeFiles, allFiles);\n       //     }\n       // }, false);\n        function isInSubDirectory(fullPath, programDir) {\n            var fileEntry = FS.lookupPath(fullPath, { follow: true });\n            if (fileEntry!= null && fileEntry.node.isFolder) {\n                var entries = FS.readdir(fullPath).filter(function(param) {\n                    return param !== \".\" && param !== \"..\" && param !== \"__MACOSX\";\n                });\n                for(var idx = 0; idx < entries.length; idx++) {\n                    if(entries[idx] === programDir) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        }\n        function getEmulatorParams() {\n            var params = [\"-root\", \"/root/base\"];\n            params.push(\"-mount_drive\");\n            params.push(Config.appDirPrefix);\n            params.push(\"d\");\n            params.push(\"-nozip\");\n            if(!Config.isSoundEnabled){\n                params.push(\"-nosound\");\n            }\n            if(Config.bpp != DEFAULT_BPP){\n                params.push(\"-bpp\");\n                params.push(\"\" + Config.bpp);\n            }\n            if(Config.cpu.length > 0){\n                params.push(\"-\" + Config.cpu);\n            }\n            if(Config.glext.length > 0){\n                params.push(\"-glext\");\n                params.push(Config.glext);\n            }\n            if(Config.WorkingDir.length > 0){\n                params.push(\"-w\");\n                params.push(Config.WorkingDir);\n            }else if(Config.appPayload.length > 0 && Config.Program.length > 0 && Config.Program.substring(0 ,1) != \"/\"){\n                params.push(\"-w\");\n                params.push(\"/home/username/.wine/dosdevices/d:\");\n            }else if(Config.appZipFile.length > 0 && Config.Program.length > 0 && Config.Program.substring(0 ,1) != \"/\"){\n                var subDirectory = Config.appZipFile.substring(0, Config.appZipFile.lastIndexOf(\".\"));\n                params.push(\"-w\");\n                if(isInSubDirectory(Config.appDirPrefix, subDirectory)){\n                    params.push(\"/home/username/.wine/dosdevices/d:/\" + subDirectory);\n                }else{\n                    params.push(\"/home/username/.wine/dosdevices/d:\");\n                }\n            }\n            params.push(\"/bin/wine\");\n            if(Config.Program.length > 0){\n                if (Config.Program.endsWith('.bat')) {\n                    params.push(\"cmd\");\n                    params.push(\"/c\");\n                }\n                params.push(Config.Program);\n            }else{\n                params.push(\"explorer\");\n                params.push(\"/desktop=shell\");\n            }\n            console.log(\"Emulator params:\" + params);\n            return params;\n        }\n      var Module = {\n        logReadFiles : false, //enable if you want to prune with tools/common utility\n        preRun: [initialSetup],\n        arguments: [],\n        postRun: [],\n        print: (function() {\n          //var element = document.getElementById('output');\n         // if (element) element.value = ''; // clear browser cache\n          return function(text) {\n            text = Array.prototype.slice.call(arguments).join(' ');\n            // These replacements are necessary if you render to raw HTML\n            //text = text.replace(/&/g, \"&amp;\");\n            //text = text.replace(/</g, \"&lt;\");\n            //text = text.replace(/>/g, \"&gt;\");\n            //text = text.replace('\\n', '<br>', 'g');\n            console.log(text);\n            //remove in browser console\n            /*if (element) { \n              element.value += text + \"\\n\";\n              element.scrollTop = element.scrollHeight; // focus on bottom\n            }\n            */\n          };\n        })(),\n        printErr: function(text) {\n          text = Array.prototype.slice.call(arguments).join(' ');\n          if (0) { // XXX disabled for safety typeof dump == 'function') {\n            dump(text + '\\n'); // fast, straight to the real console\n          } else {\n            console.error(text);\n          }\n        },\n        canvas: (function() {\n          var canvas = document.getElementById('canvas');\n\n          // As a default initial behavior, pop up an alert when webgl context is lost. To make your\n          // application robust, you may want to override this behavior before shipping!\n          // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2\n          canvas.addEventListener(\"webglcontextlost\", function(e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);\n          canvas.width  = 800;\n          canvas.height = 600;\n          return canvas;\n        })(),\n        setStatus: function(text) {\n          if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };\n          if (text === Module.setStatus.text) return;\n          var m = text.match(/([^(]+)\\((\\d+(\\.\\d+)?)\\/(\\d+)\\)/);\n          var now = Date.now();\n          if (m && now - Date.now() < 30) return; // if this is a progress update, skip it if too soon\n          if (m) {\n            text = m[1];\n            progressElement.value = parseInt(m[2])*100;\n            progressElement.max = parseInt(m[4])*100;\n            progressElement.hidden = false;\n            spinnerElement.hidden = false;\n          } else {\n            progressElement.value = null;\n            progressElement.max = null;\n            progressElement.hidden = true;\n            if (!text) spinnerElement.hidden = true;\n          }\n          statusElement.innerHTML = text;\n        },\n        totalDependencies: 0,\n        monitorRunDependencies: function(left) {\n          this.totalDependencies = Math.max(this.totalDependencies, left);\n          Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : '');\n        }\n      };\n      Module.setStatus('Downloading...');\n      window.onerror = function() {\n        Module.setStatus('Exception thrown, see JavaScript console');\n        spinnerElement.style.display = 'none';\n        Module.setStatus = function(text) {\n          if (text) Module.printErr('[post-exception status] ' + text);\n        };\n      };\n\n        function isHomeDirectory(str){\n            if(str.length >= 10){\n                if(str.substring(0,10) === '/root/home'){\n                    return true;\n                }\n            }\n            return false;\n        }\n        function startWithFiles(files){\n            for (let i = 0; i < files.length; i++) {\n                uploadFile(files[i]);\n            }\n        }\n        function uploadFile(file, fullPath, allFiles)\n        {\n            let filename = null;\n            if(fullPath){\n                filename = fullPath.startsWith(\"/\") ? fullPath.substring(1) : fullPath;\n            }else{\n                filename = file.webkitRelativePath.length == 0 ? file.name : file.webkitRelativePath;\n            }\n            var filereader = new FileReader();\n            filereader.file_name = file.name;\n            filereader.onload = function(){readFile(this.result, filename, allFiles)};\n            filereader.readAsArrayBuffer(file);\n        }\n        function extractLastPartOfPath(str){\n                return str.substring(str.lastIndexOf(\"/\")+1,str.length);\n        }\n        function extractFirstPartOfPath(str){\n                return str.substring(0,str.lastIndexOf(\"/\"));\n        }\n        function extractFilenameExtension(str){\n                return str.substring(str.lastIndexOf(\".\")+1,str.length);\n        }\n        function extractFilenameWithoutExtension(str){\n                return str.substring(0, str.lastIndexOf(\".\"));\n        }\n        function readFile(data, name, allFiles){\n            var fileExt = extractFilenameExtension(name);\n            if(fileExt.toLowerCase() === 'zip'){\n                var filenameNoExt = extractFilenameWithoutExtension(name);\n                if(!createFolder(Config.appDirPrefix, filenameNoExt)){//If dir exists and user says no to replace existing dir, then stop here\n                    return;\n                }\n                var zipDirPrefix = Config.appDirPrefix + filenameNoExt;\n                var zip = new JSZip(data);\n                for(var entry in zip.files)\n                {\n                    var data = zip.file(entry);\n                    if(data != null){\n                        var buf = data.asUint8Array();\n                        var parent = zipDirPrefix + \"/\" + extractFirstPartOfPath(entry) ;\n                        var filename = extractLastPartOfPath(entry);\n                        createFile(parent, filename, buf);\n                    }else{ //directory\n                        var fullPath = entry.substring(0,entry.length-1);\n                        var parent = extractFirstPartOfPath(fullPath);\n                        var dir = extractLastPartOfPath(fullPath);\n                        if(parent.length == 0){\n                            parent = zipDirPrefix;\n                        }else{\n                            parent = zipDirPrefix + \"/\" + parent;\n                        }\n                        createFolder(parent, dir);\n                    }\n                }\n            }else{\n                var done = false;\n                var startIndex = 0;\n                var base = Config.appDirPrefix;\n                var filename = extractLastPartOfPath(name);\n                while(!done){\n                    var dirIndex = name.indexOf(\"/\", startIndex);\n                    if(dirIndex == -1){\n                        done =true;\n                    }else{\n                        var dirName = name.substring(startIndex, dirIndex);\n                        var key = base + dirName;\n                        if(dirName.length > 0) {\n                            if(uniqueDirs[key] == null && dirName.length > 0){\n                                createFolder(base, dirName);\n                                uniqueDirs[key] = \"\";\n                            }\n                            base = base + dirName + \"/\";\n                        }\n                        startIndex = dirIndex + 1;\n                    }\n                }\n                createFile(base.substring(0,base.length-1), filename, new Uint8Array(data));\n                if(allFiles){\n                    allFiles.pop(name);\n                }\n            }\n        }\nfunction calcBackupFilename()\n{\n    var d = new Date();\n    var str =d.toISOString();\n    str = \".backup.\" + str.split(\":\").join(\".\");\n    return str;\n}\nfunction createFolder(parent, dir)\n{\n    var created = true;\n    \n    try{\n        console.log({parent, dir});\n        FS.createPath(parent, dir, true, true);\n        //console.log(entry + \" is a dir parent=\"+parent+\" dir=\"+dir);\n        console.log(\"Directory created :\" + parent + \"/\" +  dir);\n    }catch(ef){\n      if(ef.message === \"File exists\" || ef.message === \"FS error\"){\n        console.log(\"Directory already exists! :\" + parent + dir);\n        var replace = confirm(\"Directory already exists: \" + parent + dir+\" continue?\");\n        if(replace){\n            try{\n                //yeah, like that would work! FS.rmdir(parent + dir);\n                FS.rename(parent + dir,parent + dir + calcBackupFilename());\n                FS.createPath(parent, dir, true, true);\n                console.log(\"Directory replaced: \" + parent + dir);\n            }catch(eef){\n                console.log(\"eef=\"+eef);\n                created = false;\n                alert(\"unable to create folder: \"+ parent + dir);\n            }\n        }else{\n            created = false;\n        }\n      }else{\n        console.log(\"ef=\"+ef);\n      }\n    }\n    return created;\n}\nfunction createFile(dir, name, buf)\n{\n    if(dir.includes(\"__MACOSX\")) {\n        return\n    }\n\n    try{\n        FS.createDataFile(dir, name, buf, true, true);\n        console.log(\"File created :\" + dir + \"/\" + name);\n    }catch(e){\n      if(e.message === \"File exists\" || e.message === \"FS error\"){\n        console.log(\"File already exists!: \" + dir + name);\n        var replace = confirm(\"File already exists: \" + dir + \"/\" + name+\" replace?\");\n        if(replace){\n            try{\n                FS.unlink(dir + \"/\" + name);\n                FS.createDataFile(dir, name, buf, true, true);\n                console.log(\"File replaced: \" + dir + name);\n            }catch(ee){\n                console.log(\"ee=\"+ee);\n                alert(\"unable to create file: \"+ dir + name);\n            }\n        }\n      }else{\n        console.log(\"e=\"+e);\n      }\n    }\n}\n    /*\nfunction toggleConsole() {\n    var el = document.getElementById('showConsole');\n    var console = document.getElementById('output');\n    if(el.checked){\n        console.style.display = '';\n    }else{\n        console.style.display = 'none';\n    }\n}\n    */\nfunction toggleSound() {\n    var el = document.getElementById('soundToggle');\n    Config.isSoundEnabled = el.checked;\n}\nfunction toggleDirectory(item){\n    var itemWidget =document.getElementById(item);\n    if(itemWidget!=null){\n        if(itemWidget.style.display=='none'){//show\n            itemWidget.style.display=\"\";\n            document.getElementById(item+'-expand').style.display=\"none\";\n            document.getElementById(item+'-contract').style.display=\"\";\n        }else{//hide\n            itemWidget.style.display=\"none\";\n            document.getElementById(item+'-expand').style.display=\"\";\n            document.getElementById(item+'-contract').style.display=\"none\";\n        }\n    }\n}\nfunction getParameter(inputKey){\n    var retVal=\"\";\n    var replacementParameters = Config.urlParams;\n    var url = replacementParameters.length > 0 ? \"?\" + replacementParameters : window.location.href;\n    var index = url.indexOf(\"?\")+1;\n    if(index > 0){\n        var paramStr = url.substring(index);\n        var params = paramStr.split(\"&\");\n        for(var x=0;x<params.length;x++){\n            var param = params[x];\n            var kv = param.split(\"=\");\n            var key = kv[0];\n            if(key === inputKey){\n                retVal = kv[1];\n                break;\n            }\n        }\n    }\n    var hashIndex = retVal.lastIndexOf('#');\n    if(hashIndex > 0 ) {\n        retVal = retVal.substring(0, hashIndex);\n    }\n    return retVal;\n}\nfunction select(index, dir, filename){\n    if(selectedItem != null){\n        selectedItem.style.backgroundColor = \"\";\n    }\n    selectedItem = document.getElementById(index + '-data');\n    selectedItem.style.backgroundColor=\"#94c2c5\";\n    var fullpath = dir;\n    if(filename != null){\n        fullpath = fullpath + filename;\n    }\n    document.getElementById('selectedItem').value = fullpath\n    selectedFilename = filename\n}\nfunction endsWith(str, suffix){\n    return str.indexOf(suffix, str.length - suffix.length) !== -1;\n}\nfunction extract(){\n    if(url != null){\n        window.URL.revokeObjectURL(url);\n    }\n    var file = document.getElementById('selectedItem').value;\n    if(file != null && file.length > 0 && files.length > 1) {\n        if(endsWith(file,\"/\")){\n            file = file.substring(0,file.length - 1);\n        }\n        var isDirectory = false;\n        var outputFilename;\n        if(selectedFilename !=null){\n            outputFilename = selectedFilename;\n        }else{\n            isDirectory = true;\n            outputFilename = file.substring(file.lastIndexOf('/') + 1) + \".zip\";\n        }\n\n        var blob = getFile(file, isDirectory);\n        url = window.URL.createObjectURL(blob);\n        ae.href = url;\n        ae.download = outputFilename;\n        ae.click();\n    }\n}\nfunction done(){\n    if(url != null){\n        window.URL.revokeObjectURL(url);\n    }\n}\nfunction leaf(entry){\n    index++;\n    var text = \"<tr><td ><span id=\\\"\" + index + \"-data\\\" onclick=\\\"select(\" + index + \",'\" + entry.dir + \"','\" + entry.filename + \"')\\\">\" + entry.filename + \"</span></td></tr>\";\n    return text;\n}\nfunction branch(entries){\n    var item = entries[index];\n    index++;\n    var dir = item.dir;\n    var dirName = dir.substring(0, dir.length - 1);\n    dirName = dirName.substring(dirName.lastIndexOf(\"/\")+1,dirName.length);\n    var text = \"<tr>\";\n    text = text + \"<td>\";\n    text = text + \"<span id=\\\"\" + index + \"-expand\\\"><a onclick=\\\"toggleDirectory('\" + index + \"')\\\"><strong>+</strong></a></span>\";\n    text = text + \"<span id=\\\"\" + index + \"-contract\\\" style=\\\"display:none;\\\"><a onclick=\\\"toggleDirectory('\" + index + \"')\\\"><strong>-</strong></a></span>\";\n    text = text + \"<span id=\\\"\" + index + \"-data\\\" onclick=\\\"select(\" + index + \",'\" + dir + \"', null)\\\">[\" + dirName + \"]</span>\";\n    text = text + \"<div id='\" + index + \"' style=\\\"display:none;\\\">\";\n    text = text + \"<table>\";\n    while(index < entries.length){\n        var nextItem = entries[index];\n        if(nextItem.dir === item.dir){\n            text = text + leaf(nextItem);\n        }else if(parentDir(nextItem.dir) === item.dir){\n            text = text + branch(entries, index);\n        }else{\n            break;\n        }\n    }\n    text = text + \"</table>\";\n    text = text + \"</div>\";\n    text = text + \"</td>\";\n    text = text + \"</tr>\";\n    return text;\n}\nfunction parentDir(childDir)\n{\n    if(endsWith(childDir,\"/\")){\n        childDir = childDir.substring(0,childDir.length - 1);\n    }\n    var parentDir= childDir.substring(0, childDir.lastIndexOf('/') + 1);\n    return parentDir;\n}\nfunction buildTree()\n{\n    document.getElementById('modalLink').click();\n    var root = document.getElementById('tree');\n    //reset\n    document.getElementById('selectedItem').value = \"\";\n    selectedFilename = null;\n    files = [];\n    root.innerHTML = \"\";\n    index = 0;\n\n    var currentDir = Config.appDirPrefix;\n    readFiles(currentDir, files);\n\n    //now build tree\n    var contents = \"<table>\";\n    contents = contents + branch(files);\n    contents = contents + \"</table>\";\n    document.getElementById('loadStatus').style.display=\"none\";\n\n    root.innerHTML = contents;\n    toggleDirectory('1');\n}\n\nfunction readFiles(currentDir, files)\n{\n\n    console.log(\"adding directory: \" + currentDir);\n    files.push({dir : currentDir, filename : \"\"});\n    var entries = FS.readdir(currentDir).filter(function(param) {\n        return param !== \".\" && param !== \"..\";\n    });\n    entries.forEach(function(entry) {\n        var fileEntry = FS.lookupPath(currentDir + entry, { follow: true });\n        if (fileEntry.node.isFolder) {\n            readFiles(currentDir + entry + \"/\", files);\n        }else{\n            console.log(\"adding file: \" + currentDir + entry);\n            files.push({dir : currentDir, filename : entry});\n        }\n    });\n}\n\nfunction startsWith(str, prefix)\n{\n    return str.slice(0, prefix.length) == prefix;\n}\nfunction getFile(file, isDirectory)\n{\n    if(isDirectory){//zip up directory\n        var zip = new JSZip();\n        files.forEach(function(eachFile) {\n            if(startsWith(eachFile.dir, file)){\n                if(eachFile.filename !== \"\"){\n                      var fileLocation = eachFile.dir + eachFile.filename;\n                      var data = FS.readFile(fileLocation, { encoding: 'binary' });\n                      zip.file(fileLocation.substring(file.length), data);\n                }else{\n                        zip.file(eachFile.dir.substring(file.length), null, {dir: true});\n                }\n            }\n        });\n        return zip.generate({type:\"blob\", compression:\"DEFLATE\"});\n    }else{\n        var data = FS.readFile(file, { encoding: 'binary' });\n        return new Blob([data], {type: \"octet/stream\"});\n    }\n}\n\n"]}