{"version":3,"sources":["boxedwine-shell.js"],"names":["ALLOW_PARAM_OVERRIDE_FROM_URL","SUPPRESS_WINEBOOT","ROOT","STORAGE_DROPBOX","STORAGE_LOCAL_STORAGE","STORAGE_MEMORY","ONDEMAND_DEFAULT","ONDEMAND_ROOT","DROPBOX_APP_KEY","RECEIVE_URL","DEFAULT_AUTO_RUN","DEFAULT_SOUND_ENABLED","DEFAULT_APP_DIRECTORY","DEFAULT_BPP","DEFAULT_ROOT_ZIP_FILE","Config","locateRootBaseUrl","locateAppBaseUrl","locateOverlayBaseUrl","urlParams","storageMode","isRunningInline","showUploadDownload","selectedItem","selectedFilename","isRunning","uniqueDirs","timer","index","files","client","alreadyBuiltFileSystem","ae","document","createElement","body","appendChild","style","url","statusElement","getElementById","progressElement","spinnerElement","flag_r","isReadable","isWriteable","isTruncating","isAppendable","isSynchronous","isExclusive","pathExistsAction","pathNotExistsAction","setConfiguration","appDirPrefix","isAutoRunSet","getAutoRun","rootZipFile","extraZipFiles","appZipFile","appPayload","getPayload","extraPayload","Program","WorkingDir","getWorkingDirectory","isSoundEnabled","getSound","bpp","getBitsPerPixel","useRangeRequests","getUseRangeRequests","glext","getGLExtensions","cpu","getCPU","allowParameterOverride","length","getParameter","console","log","startsWith","endsWith","substring","split","join","auto","param","payload","ondemand","soundEnabled","dir","getAppZipFile","filename","getRootZipFile","getZipFileList","zipFiles","ondemandMinOverlay","push","filenames","zipFilenames","i","auth_callback","error","alert","isAuthenticated","disabled","textContent","buildFileSystem","BrowserFS","FileSystem","InMemory","dropboxLogin","Dropbox","Client","key","authDriver","AuthDriver","Popup","receiverUrl","authenticate","initFileSystem","writableStorage","LocalStorage","isAvailable","syncGet","offset","req","XMLHttpRequest","open","data","err","overrideMimeType","range","setRequestHeader","onreadystatechange","e","readyState","status","text","responseText","Int8Array","charCodeAt","send","getFileSize","p","Promise","resolve","reject","Error","parseInt","getResponseHeader","onerror","then","result","getCentralOffset","buffer","pos","byteLength","top","Math","max","isDropBox","display","hidden","Buffer","BFSRequire","buildExtraFileSystems","extraFSs","buildAppFileSystems","homeAdapter","buildRemoteZipFile","zipfs","buildBrowserFileSystem","rootListingObject","XmlHttpRequest","Create","baseUrl","e2","xmlHttpFs","rootMfs","MountableFileSystem","mount","readFile","contents","ZipFS","zipData","e3","zipFilename","zipFileCallback","fileSizeAsString","fileSizeAsInt","Number","blockSize","lastPartOfFile","centralOffset","Uint8Array","name","getBase64Data","base64Data","bytes","atob","contentLength","adapterCallback","e4","additionalZipfs","FolderAdapter","listingObject","mfs","fsCallback","FS","createPath","root","OverlayFS","readable","writable","rootOverlay","deleteFile","initialize","homeOverlay","mirrorFS","AsyncMirror","postBuildFileSystem","rootFS","homeFS","BFS","EmscriptenFS","recursiveCopy","startEmulator","toggleConsole","start","startBtn","soundToggle","checked","fs","pathAndFilename","unlinkSync","ef","message","createFolders","mainfs","folders","directory","k","mkdirSync","prefix","path","copyDirectory","createFolderIfNecessary","readdirSync","forEach","item","file","statSync","isDirectory","createFileIfNecessary","fullPath","parent","extractFirstPartOfPath","extractLastPartOfPath","readFileSync","createDataFile","unlink","lookupPath","follow","cef","params","getEmulatorParams","Module","loadScreen","canvas","ctx","getContext","font","textAlign","fillText","width","height","initialSetup","getExecutable","prog","errorCallback","dirCount","getEntriesAsPromise","exeFiles","allFiles","reader","createReader","doBatch","readEntries","entries","entry","loadExeModal","uppercase","toUpperCase","uploadFile","click","innerHTML","setInterval","readyCheck","populateModalExe","listElement","element","addEventListener","event","execute","clearInterval","isInSubDirectory","programDir","fileEntry","node","isFolder","readdir","filter","idx","subDirectory","lastIndexOf","dropzone","preventDefault","items","dataTransfer","webkitGetAsEntry","logReadFiles","preRun","arguments","postRun","print","value","Array","prototype","slice","call","printErr","setStatus","last","time","Date","now","m","match","totalDependencies","monitorRunDependencies","left","this","isHomeDirectory","str","startWithFiles","webkitRelativePath","filereader","FileReader","file_name","onload","readAsArrayBuffer","extractFilenameExtension","extractFilenameWithoutExtension","toLowerCase","filenameNoExt","createFolder","zipDirPrefix","zip","JSZip","buf","asUint8Array","createFile","done","startIndex","base","dirIndex","indexOf","dirName","pop","calcBackupFilename","toISOString","created","confirm","rename","eef","includes","ee","el","toggleSound","toggleDirectory","itemWidget","inputKey","retVal","replacementParameters","window","location","href","x","kv","hashIndex","select","backgroundColor","fullpath","suffix","extract","URL","revokeObjectURL","outputFilename","blob","getFile","createObjectURL","download","leaf","branch","nextItem","parentDir","childDir","buildTree","readFiles","currentDir","eachFile","fileLocation","encoding","generate","type","compression","Blob"],"mappings":"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","file":"boxedwine-shell.js","sourcesContent":["        let ALLOW_PARAM_OVERRIDE_FROM_URL = true;\n        let SUPPRESS_WINEBOOT = true; //prevent wine from re-creating .wine directory\n        let ROOT = \"/root\";\n        let STORAGE_DROPBOX = \"DROPBOX\";\n        let STORAGE_LOCAL_STORAGE = \"LOCAL_STORAGE\";\n        let STORAGE_MEMORY = \"MEMORY\";\n\n        let ONDEMAND_DEFAULT = \"notset\";\n        let ONDEMAND_ROOT = \"root\";\n\n        let DROPBOX_APP_KEY = 'put key in here';\n        let RECEIVE_URL = \"http://put url in here/oauth_receiver.html\";\n\n        let DEFAULT_AUTO_RUN = true;\n        let DEFAULT_SOUND_ENABLED = true;\n        let DEFAULT_APP_DIRECTORY = ROOT + \"/files/\";\n        let DEFAULT_BPP = 32;\n        let DEFAULT_ROOT_ZIP_FILE = \"boxedwine.zip\";\n        //params\n        let Config = {};\n        Config.locateRootBaseUrl = \"\";\n        Config.locateAppBaseUrl = \"\";\n        Config.locateOverlayBaseUrl = \"\";\n        Config.urlParams = \"\";\n        Config.storageMode = STORAGE_MEMORY;\n        Config.isRunningInline = false;\n        Config.showUploadDownload = false;\n\n        var isRunning = false;\n        var uniqueDirs = {};\n        var timer = null;\n        var index = 0;\n        var selectedItem;\n        var selectedFilename;\n        var files = []; //used for constructing tree and for retrieving files when zipping\n        var client = null;\n        var alreadyBuiltFileSystem = false;\n\n        var ae = document.createElement(\"a\");\n        document.body.appendChild(ae);\n        ae.style = \"display: none\";\n        var url = null;\n          var statusElement = document.getElementById('status');\n          var progressElement = document.getElementById('progress');\n          var spinnerElement = document.getElementById('spinner');\n  //      var dropzone = document.getElementById(\"dropzone\");\n\n\n    //recursive copy based on code in emularity github project\n    var flag_r = { isReadable: function() { return true; },\n        isWriteable: function() { return false; },\n        isTruncating: function() { return false; },\n        isAppendable: function() { return false; },\n        isSynchronous: function() { return false; },\n        isExclusive: function() { return false; },\n        pathExistsAction: function() { return 0; },\n        pathNotExistsAction: function() { return 1; }\n    };\n        function setConfiguration() {\n            Config.appDirPrefix = DEFAULT_APP_DIRECTORY;\n            Config.isAutoRunSet = getAutoRun();\n            //Modified to launch cmd \n            //cull unused functions in future!\n            Config.rootZipFile = \"boxedwine.zip\"//getRootZipFile(\"root\"); //MANUAL:\"base.zip\";\n            Config.extraZipFiles = \"\"; //getZipFileList(\"overlay\"); //MANUAL:\"dlls.zip;fonts.zip\";\n            Config.appZipFile = \"assembler.zip\"//getAppZipFile(\"app\"); //MANUAL:\"chomp.zip\";\n            Config.appPayload = getPayload(\"app-payload\"); \n            Config.extraPayload = \"\"//getPayload(\"overlay-payload\"); \n            Config.Program = \"cmd.bat\";//getExecutable(); //MANUAL:\"CHOMP.EXE\";\n            //end\n            Config.WorkingDir = getWorkingDirectory(); //MANUAL:\"\";\n            Config.isSoundEnabled = getSound();\n            Config.bpp = getBitsPerPixel();\n            Config.useRangeRequests = getUseRangeRequests();\n            Config.glext = getGLExtensions();\n            Config.cpu = getCPU();\n        }\n        function allowParameterOverride() {\n            if(Config.urlParams.length >0) {\n                return true;\n            }\n            return ALLOW_PARAM_OVERRIDE_FROM_URL;\n        }\n        function getCPU(){\n            var cpu = getParameter(\"cpu\");\n            if(!allowParameterOverride()){\n                cpu = \"\";\n            }else if(cpu == \"p2\") {\n                cpu = \"p2\";\n            }else if(cpu == \"p3\") {\n                cpu = \"p3\";\n            }else{\n                cpu = \"\";\n            }\n            if(cpu.length > 0) {\n                console.log(\"setting CPU to: \"+cpu);\n            }\n            return cpu;\n        }\n        function getBitsPerPixel(){\n\n            var bpp =  getParameter(\"bpp\");\n            if(!allowParameterOverride()){\n                bpp = DEFAULT_BPP;\n            }else if(bpp == \"8\") {\n                bpp = 8;\n            }else if(bpp == \"16\") {\n                bpp = 16;\n            }else if(bpp == \"32\"){\n                bpp = 32;\n            }else{\n                bpp = DEFAULT_BPP;\n            }\n            console.log(\"setting BPP to: \"+bpp);\n            return bpp;\n        }\n        function getGLExtensions(){ //GL not yet available from JS\n            var glext = getParameter(\"glext\");\n            if(!allowParameterOverride()){\n                glext = \"\";\n            }else{\n                if(glext.length > 6) {\n                    if( (glext.startsWith(\"%22\") && glext.endsWith(\"%22\") )\n                        || (glext.startsWith('%27') && glext.endsWith('%27'))){\n                        glext = glext.substring(3, glext.length - 3);\n                        glext = glext.split('%20').join(' ');\n                        glext = '\"' + glext +  '\"';\n                    }else{\n                        console.log(\"glext paramater must be in quoted string\");\n                    }\n                }\n            }\n            if(glext.length > 0) {\n                console.log(\"setting glext to: \"+glext);\n            }\n            return glext;\n        }\n        function getAutoRun(){\n\n            var auto =  getParameter(\"auto\");\n            if(!allowParameterOverride()){\n                auto = DEFAULT_AUTO_RUN;\n            }else if(auto == \"true\") {\n                auto = true;\n            }else if(auto == \"false\"){\n                auto = false;\n            }else{\n                auto = DEFAULT_AUTO_RUN;\n            }\n            if(!auto && Config.isRunningInline){\n                console.log(\"parameter mismatch. Auto run can't be false if running inline. Resetting auto run to true\");\n                auto = true;\n            }\n            console.log(\"setting auto run to: \"+auto);\n            return auto;\n        }\n        function getPayload(param) {\n            var payload =  getParameter(param);\n            if(!allowParameterOverride()){\n                payload = \"\";\n            }\n            return payload;\n        }\n        function getUseRangeRequests(){\n            var ondemand =  getParameter(\"ondemand\");\n            \n            if(!allowParameterOverride()){\n                ondemand = ONDEMAND_DEFAULT;\n            }else if(ondemand == ONDEMAND_ROOT) {\n            }else{\n                ondemand = ONDEMAND_DEFAULT;\n            }\n            console.log(\"setting ondemand to: \"+ondemand);\n            return ondemand;\n        }\n        function getSound(){\n            var soundEnabled =  getParameter(\"sound\");\n            if(!allowParameterOverride()){\n                soundEnabled = DEFAULT_SOUND_ENABLED;\n            }else if(soundEnabled == \"true\") {\n                soundEnabled = true;\n            }else if(soundEnabled == \"false\"){\n                soundEnabled = false;\n            }else{\n                soundEnabled = DEFAULT_SOUND_ENABLED;\n            }\n            console.log(\"setting sound to: \"+soundEnabled);\n            return soundEnabled;\n        }\n        function getWorkingDirectory(){\n\n            var dir =  getParameter(\"work\");\n            if(!allowParameterOverride() || dir===\"\"){\n                dir = \"\";\n            }else{\n                if(dir.startsWith('c:/')){\n                    dir = \"/home/username/.wine/dosdevices/c:/\" + dir.substring(3);\n                    console.log(\"setting working directory to: \"+dir);\n                }else if(dir.startsWith('d:/')){\n                    dir = \"/home/username/.wine/dosdevices/d:/\" + dir.substring(3);\n                    console.log(\"setting working directory to: \"+dir);\n                }else{\n                    console.log(\"unable to set work directory\");\n                }\n            }\n            return dir;\n        }\n        function getAppZipFile(param){\n\n            var filename =  getParameter(param);\n            if(!allowParameterOverride() || filename===\"\"){\n                filename = \"\";\n                console.log(\"not setting \" + param + \" zip file\");\n            }else{\n                if(!filename.endsWith(\".zip\")){\n                    filename = filename + \".zip\";\n                }\n                console.log(\"setting \" + param + \" zip file to: \"+filename);\n            }\n            return filename;\n        }\n\n        //Not needed\n        function getRootZipFile(param){\n\n            var filename =  getParameter(param);\n            if(!allowParameterOverride() || filename===\"\"){\n                filename = DEFAULT_ROOT_ZIP_FILE;\n            }else{\n                if(!filename.endsWith(\".zip\")){\n                    filename = filename + \".zip\";\n                }\n            }\n            console.log(\"setting \" + param + \" zip file to: \"+filename);\n\n            return filename;\n        }\n        function getZipFileList(param){\n            var zipFiles = [];\n            if(Config.isRunningInline) {\n                let ondemandMinOverlay =  getParameter(\"inline-default-ondemand-root-overlay\");\n                if(ondemandMinOverlay.length > 0) {\n                    if(!ondemandMinOverlay.endsWith(\".zip\")){\n                        ondemandMinOverlay = ondemandMinOverlay + \".zip\";\n                    }\n                    zipFiles.push(ondemandMinOverlay);\n                }\n            }\n            var filenames =  getParameter(param);\n            if(!allowParameterOverride() || filename===\"\"){\n                console.log(\"not setting \" + param + \" zip file(s)\");\n            }else{\n                if(filenames.length > 0) {\n                    var zipFilenames = filenames.split(';');\n                    for(var i=0; i < zipFilenames.length;i++) {\n                        var filename = zipFilenames[i];\n                        if(!filename.endsWith(\".zip\")){\n                            filename = filename + \".zip\";\n                        }\n                        zipFiles.push(filename);\n                    }\n                }\n            }\n            if(zipFiles.length > 0) {\n                console.log(\"setting \" + param + \" zip file(s) to: \"+zipFiles);\n            }\n            return zipFiles;\n        }\n        function auth_callback(error) {\n            if (error) {\n                alert('Authentication error: ' + error);\n                return;\n            }\n            if (client.isAuthenticated()) {\n                if(alreadyBuiltFileSystem){\n                    return;\n                }\n                alreadyBuiltFileSystem = true;\n                document.getElementById('startbtn').disabled = true;\n                document.getElementById('startbtn').textContent = \"Syncing...\";\n                console.log(\"authenticated!\");\n                buildFileSystem(new BrowserFS.FileSystem.InMemory(), true);\n            } else {\n                alert('unable to authenticate');\n            }\n        }\n        function dropboxLogin()\n        {\n            client = new Dropbox.Client({key: DROPBOX_APP_KEY});\n            client.authDriver(new Dropbox.AuthDriver.Popup({receiverUrl: RECEIVE_URL}));\n            client.authenticate(auth_callback);\n            document.getElementById('startbtn').textContent = \"Start\";\n        }\n        function initFileSystem()\n        {\n            console.log(\"Use Storage mode: \"+Config.storageMode);\n            if(Config.storageMode === STORAGE_LOCAL_STORAGE){\n                var writableStorage;\n                if(BrowserFS.FileSystem.LocalStorage.isAvailable){\n                    writableStorage = new BrowserFS.FileSystem.LocalStorage();\n                }else{\n                    writableStorage = new BrowserFS.FileSystem.InMemory();\n                    console.log(\"Switching to In Memory store as LocalStorage is not available\");\n                }\n                buildFileSystem(writableStorage, false);\n            //not using drop box\n            //}else if(Config.storageMode === STORAGE_DROPBOX){\n            //    client.authenticate({interactive:false}, auth_callback);\n            }else{\n                buildFileSystem(new BrowserFS.FileSystem.InMemory(), false);\n            }\n        }\n        //function from browserfs\n        function syncGet(url, offset, length)\n        {\n          let req = new XMLHttpRequest();\n          req.open('GET', Config.locateRootBaseUrl + url, false);\n          let data = null;\n          let err = null;\n          // Classic hack to download binary data as a string.\n          req.overrideMimeType('text/plain; charset=x-user-defined');\n          let end = offset + length - 1;\n          let range = \"bytes=\" + offset + \"-\" + end;\n          req.setRequestHeader('Range', range);\n          req.onreadystatechange = function(e) {\n            if (req.readyState === 4) {\n              if (req.status === 200 || req.status === 206) {\n                    // Convert the text into a buffer.\n                    const text = req.responseText;\n                    data = new Int8Array(text.length);\n                    // Throw away the upper bits of each character.\n                    for (let i = 0; i < text.length; i++) {\n                      // This will automatically throw away the upper bit of each\n                      // character for us.\n                      data[i] = text.charCodeAt(i);\n                    }\n                    return;\n              } else {\n                err = \"XHR error.\";\n                return;\n              }\n            }\n          };\n          req.send();\n          if (err) {\n            throw err;\n          }\n          return data;\n        }\n        function getFileSize(p  )\n        {\n            return new Promise(function(resolve, reject) {\n                  const req = new XMLHttpRequest();\n                  req.open('HEAD', Config.locateRootBaseUrl + p);\n                  req.onreadystatechange = function(e) {\n                    if (req.readyState === 4) {\n                      if (req.status === 200) {\n                        try {\n                          resolve(parseInt(req.getResponseHeader('Content-Length') || '-1', 10));\n                        } catch (e) {\n                          throw e;\n                        }\n                      } else {\n                        throw new Error(\"Unable to get file size\");\n                      }\n                    }\n                  };\n                  req.onerror = function() {\n                      reject(Error(\"Network Error\"));\n                  };\n                  req.send();\n              }).then(function(result, err) {\n                  if (err != null) {\n                      throw new Error(err);\n                  } else {\n                      return result;\n                  }\n            }, function(err) {\n                  throw new Error(\"Something when wrong when getting file size\");\n            });\n        }\n        function getCentralOffset(buffer)\n        {\n            let ENDSIG = 101010256;\n            let ENDHDR = 22;\n            let ENDTOT = 10;\n            let ENDSIZ = 12;\n            let ENDOFF = 16;\n            let ENDNRD = 4;\n            var pos =0;\n            var offset = buffer.byteLength - ENDHDR;\n            var top = Math.max(0, offset - 65536);\n            var result = 0;\n            do {\n                if (offset < top)\n                    throw new Error(\"not a zip file?\");\n                pos = offset--;\n                result = (((buffer[pos++]) | (buffer[pos++]) << 8) | ((buffer[pos++]) | (buffer[pos++]) << 8) << 16);\n            } while (result != ENDSIG);\n            pos = ( pos + ENDTOT - ENDNRD);\n            var count = ((buffer[pos++]) | (buffer[pos++]) << 8);\n            pos = ( pos + ENDOFF - ENDSIZ);\n            return (((buffer[pos++]) | (buffer[pos++]) << 8) | ((buffer[pos++]) | (buffer[pos++]) << 8) << 16);\n        }\n\n        function buildFileSystem(writableStorage, isDropBox)\n        {\n            spinnerElement.style.display = '';\n            spinnerElement.hidden = false;\n            var Buffer = BrowserFS.BFSRequire('buffer').Buffer;\n            buildExtraFileSystems(Buffer, function(extraFSs) {\n                buildAppFileSystems(function(homeAdapter) {\n                    if(Config.useRangeRequests == ONDEMAND_ROOT) {\n                        buildRemoteZipFile(Config.rootZipFile, function callback(zipfs) {\n                            buildBrowserFileSystem(writableStorage, isDropBox, homeAdapter, extraFSs, zipfs);\n                        });\n                    } else {\n                        var rootListingObject = {};\n                        rootListingObject[Config.rootZipFile] =  null;\n                        BrowserFS.FileSystem.XmlHttpRequest.Create({\"index\":rootListingObject, \"baseUrl\": Config.locateRootBaseUrl}, function(e2, xmlHttpFs){\n                            if(e2){\n                                console.log(e2);\n                            }\n                            var rootMfs = new BrowserFS.FileSystem.MountableFileSystem();\n                            rootMfs.mount('/temp', xmlHttpFs);\n                            rootMfs.readFile('/temp/' + Config.rootZipFile, null, flag_r, function callback(e, contents){\n                                if(e){\n                                    console.log(e);\n                                }\n                                BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e3, zipfs){\n                                    if(e3){\n                                        console.log(e3);\n                                    }\n                                    buildBrowserFileSystem(writableStorage, isDropBox, homeAdapter, extraFSs, zipfs);\n                                });\n                                rootMfs = null;\n                            });\n                        });\n                    }\n                });\n            });\n        }\n\n        function buildRemoteZipFile(zipFilename, zipFileCallback)\n        {\n            var Buffer = BrowserFS.BFSRequire('buffer').Buffer;\n            getFileSize(zipFilename).then(function(fileSizeAsString) {\n                let fileSizeAsInt = Number(fileSizeAsString);\n                let blockSize = fileSizeAsInt > 100000 ? 100000 : fileSizeAsInt - 22;\n                let lastPartOfFile = syncGet(zipFilename, fileSizeAsInt - blockSize, blockSize);\n                let centralOffset = getCentralOffset(new Uint8Array(lastPartOfFile));\n                let remainingLength = fileSizeAsInt - centralOffset;\n                let contents = syncGet(zipFilename, centralOffset, remainingLength);\n                BrowserFS.FileSystem.ZipFS.Create({\"name\": Config.locateRootBaseUrl + zipFilename , \"zipData\":new Buffer(contents)}, function(e3, zipfs){\n                    if(e3){\n                        console.log(e3);\n                    }\n                    zipFileCallback(zipfs);\n                });\n            });\n        }\n        function getBase64Data(base64Data)\n        {\n            let bytes = atob(base64Data);\n            let contentLength = bytes.length;\n            var contents = new Uint8Array(contentLength);\n            for (var i = 0; i < contentLength; i++) {\n                contents[i] = bytes.charCodeAt(i);\n            }\n            return contents;\n        }\n        function buildAppFileSystems(adapterCallback)\n        {\n            var Buffer = BrowserFS.BFSRequire('buffer').Buffer;\n            if(Config.appPayload.length > 0){\n                let contents = getBase64Data(Config.appPayload);\n                BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e4, additionalZipfs){\n                    if(e4){\n                        console.log(e4);\n                    }\n                    let homeAdapter = new BrowserFS.FileSystem.FolderAdapter(\"/\", additionalZipfs);\n                    adapterCallback(homeAdapter);\n                });\n            }else if(Config.appZipFile.length > 0){\n                    var listingObject = {};\n                    listingObject[Config.appZipFile] =  null;\n                    var mfs = new BrowserFS.FileSystem.MountableFileSystem();\n                    BrowserFS.FileSystem.XmlHttpRequest.Create({\"index\":listingObject, \"baseUrl\": Config.locateAppBaseUrl}, function(e2, xmlHttpFs){\n                        if(e2){\n                            console.log(e2);\n                        }\n                        mfs.mount('/temp', xmlHttpFs);\n                        mfs.readFile('/temp/' + Config.appZipFile, null, flag_r, function callback(e, contents){\n                            if(e){\n                                console.log(e);\n                            }\n                            BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e3, additionalZipfs){\n                                if(e3){\n                                    console.log(e3);\n                                }\n                                let homeAdapter = new BrowserFS.FileSystem.FolderAdapter(\"/\", additionalZipfs);\n                                adapterCallback(homeAdapter);\n                                mfs = null;\n                            });\n                        });\n                    });\n            }else{\n                let homeAdapter = new BrowserFS.FileSystem.FolderAdapter(\"/\", new BrowserFS.FileSystem.InMemory());\n                adapterCallback(homeAdapter);\n            }\n        }\n        function buildExtraFileSystems(Buffer, fsCallback)\n        {\n            var extraFSs = [];\n            if(Config.extraPayload.length > 0){\n                let contents = getBase64Data(Config.extraPayload);\n                BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e2, zipfs){\n                    if(e2){\n                        console.log(e2);\n                    }\n                    extraFSs.push(zipfs);\n                    fsCallback(extraFSs);\n                });\n            }else if(Config.extraZipFiles.length > 0){\n                for(let i = 0; i < Config.extraZipFiles.length; i++) {\n                    var listingObject = {};\n                    listingObject[Config.extraZipFiles[i]] =  null;\n                    var mfs = new BrowserFS.FileSystem.MountableFileSystem();\n                    BrowserFS.FileSystem.XmlHttpRequest.Create({\"index\":listingObject, \"baseUrl\": Config.locateOverlayBaseUrl}, function(e2, xmlHttpFs){\n                        if(e2){\n                            console.log(e2);\n                        }\n                        mfs.mount('/temp', xmlHttpFs);\n                        mfs.readFile('/temp/' + Config.extraZipFiles[i], null, flag_r, function(e, contents){\n                            if(e){\n                                console.log(e);\n                            }\n                            BrowserFS.FileSystem.ZipFS.Create({\"zipData\":new Buffer(contents)}, function(e3, zipfs){\n                                if(e3){\n                                    console.log(e3);\n                                }\n                                extraFSs.push(zipfs);\n                                if(extraFSs.length == Config.extraZipFiles.length) {\n                                    fsCallback(extraFSs);\n                                }\n                                mfs = null;\n                            });\n                        });\n                    });\n                }\n            }else{\n                fsCallback(extraFSs);\n            }\n        }\n\n        function buildBrowserFileSystem(writableStorage, isDropBox, homeAdapter, extraFSs, zipfs)\n        {\n            FS.createPath(FS.root, 'root', FS.createPath);\n            FS.createPath(\"/root\", 'base', true, true);\n            FS.createPath(\"/root\", 'files', true, true);\n            var mainfs = null;\n\n            BrowserFS.FileSystem.OverlayFS.Create({\"readable\":zipfs,\"writable\":new BrowserFS.FileSystem.InMemory()}, function(e3, rootOverlay){\n                if(e3){\n                    console.log(e3);\n                }\n                if(SUPPRESS_WINEBOOT) {\n                   deleteFile(rootOverlay, \"/lib/wine/wineboot.exe.so\");\n                }\n\n                homeAdapter.initialize(function callback(e){\n                    if(e){\n                        console.log(e);\n                    }\n                    BrowserFS.FileSystem.OverlayFS.Create({\"readable\":homeAdapter,\"writable\":writableStorage}, function(e2, homeOverlay){\n                        if(e2){\n                            console.log(e2);\n                        }\n                        if(isDropBox) {\n                            var mirrorFS = new BrowserFS.FileSystem.AsyncMirror(homeOverlay, new BrowserFS.FileSystem.Dropbox(client));\n                            mirrorFS.initialize(function callback(e4){\n                                if(e4){\n                                    console.log(e4);\n                                }\n                                postBuildFileSystem(rootOverlay, mirrorFS, extraFSs);\n                            });\n                        }else{\n                            postBuildFileSystem(rootOverlay, homeOverlay, extraFSs);\n                        }\n                    });\n                });\n            });\n        }\n        function postBuildFileSystem(rootFS, homeFS, extraFSs)\n        {\n            var mfs = new BrowserFS.FileSystem.MountableFileSystem();\n            mfs.mount('/root/base', rootFS);\n            mfs.mount( Config.appDirPrefix.substring(0, Config.appDirPrefix.length - 1), homeFS);\n            var BFS = new BrowserFS.EmscriptenFS();\n\n            BrowserFS.initialize(mfs);\n            FS.mount(BFS, {root: '/root'}, '/root');\n            \n            for(let i = 0; i < extraFSs.length; i++) {\n                recursiveCopy(extraFSs[i], Config.extraZipFiles[i], '/');\n            }\n            extraFSs = null;\n\n            if(Config.showUploadDownload){\n                document.getElementById('uploadbtn').style.display = \"\";\n                document.getElementById('downloadbtn').style.display = \"\";\n            }\n            spinnerElement.style.display = 'none';\n            if(Config.storageMode === STORAGE_DROPBOX){\n                startEmulator();\n            }else{\n                toggleConsole();\n                if(Config.isAutoRunSet){\n                    start();\n                }else{\n                    var startBtn = document.getElementById('startbtn');\n                    startBtn.disabled = false;\n                    startBtn.style.display = \"\";\n                    var soundToggle = document.getElementById('soundToggle');\n                    if(Config.isSoundEnabled){\n                        soundToggle.checked = true;\n                    }\n                    document.getElementById('sound-checkbox').style.display = \"\";\n                }\n            }\n        }\n        function deleteFile(fs, pathAndFilename)\n        {\n            try {\n                fs.unlinkSync(pathAndFilename);\n            }catch(ef) {\n                console.log(\"Unable to delete:\" + pathAndFilename + \" error:\" + ef.message);\n            }\n        }\n        function createFolders(mainfs, folders)\n        {\n            var directory = \"\";\n            for(var k = 0; k < folders.length; k++){\n                if(folders[k].length > 0) {\n                    directory = directory + \"/\" + folders[k];\n                    mainfs.mkdirSync(directory);\n                }\n            }\n        }\n        function recursiveCopy(fs, zipFilename, filename) {\n\n            var prefix = zipFilename == null ? \"\" : \"/\" + zipFilename.substring(0, zipFilename.length - 4);\n            var path = BrowserFS.BFSRequire('path');\n            copyDirectory(fs, filename, prefix);\n            function copyDirectory(fs, filename, prefix) {\n                createFolderIfNecessary(filename, prefix);\n                fs.readdirSync(filename).forEach(function(item) {\n                    var file = path.resolve(filename, item);\n                    if(!(file.startsWith(\"/__MACOSX\") || file.endsWith(\".DS_Store\"))) {\n                        if (fs.statSync(file).isDirectory()) {\n                            copyDirectory(fs, file, prefix);\n                        } else {\n                            createFileIfNecessary(fs, file, prefix);\n                        }\n                    }\n                });\n            }\n        }\n        function createFileIfNecessary(fs, fullPath, prefix)\n        {\n            var file = fullPath;\n            if(fullPath.startsWith(prefix)) {\n                fullPath = fullPath.substring(prefix.length);\n            }\n            var parent =  extractFirstPartOfPath(fullPath);\n            if(parent.length > 0){\n                var filename = extractLastPartOfPath(fullPath);\n                var contents = fs.readFileSync(file, null, flag_r);\n                try {\n                    console.log(\"creating: root/base\" + parent + \"/\" + filename);\n                    FS.createDataFile(\"root/base\" + parent, filename, contents, true, true);\n                }catch(ef) {\n                    if(ef.message === \"File exists\" || ef.message === \"FS error\"){\n                        try {\n                            FS.unlink(\"root/base\" + parent + \"/\" + filename);\n                            FS.createDataFile(\"root/base\" + parent, filename, contents, true, true);\n                        }catch(ef) {\n                            console.log(\"file replace error:\" + ef.message + \" for: \" + parent + \"/\" + filename);\n                        }\n                    }else {\n                        console.log(\"file creation error:\" + ef.message + \" for: \" + parent + \"/\" + filename);\n                    }\n                }\n            }\n        }\n        //todo use stat!\n        function createFolderIfNecessary(fullPath, prefix)\n        {\n\n            if(fullPath.startsWith(prefix)) {\n                fullPath = fullPath.substring(prefix.length);\n            }\n            var parent = extractFirstPartOfPath(fullPath);\n            var dir = extractLastPartOfPath(fullPath);\n            if(parent.length > 0){\n                try{\n                    FS.lookupPath(\"/root/base\" + parent + \"/\" + dir, { follow: true });\n                }catch(ef){\n                    if(ef.message == \"No such file or directory\"  || ef.message === \"FS error\") {\n                        try{\n                            FS.createPath(\"/root/base/\" + parent, dir, true, true);\n                        }catch(cef) {\n                            console.log(\"Directory creation error:\" + cef.message + \" for: \" + parent + \"/\" + dir);\n                        }\n                    }else if(ef.message != \"File exists\"){\n                        console.log(\"Directory creation error:\" + ef.message+\" for: \" + parent + \"/\" +  dir);\n                    }\n                }\n            }\n        }\n        function start(){\n            if(isRunning){\n                return;\n            }\n            if(Config.isRunningInline) {\n                document.getElementById('inline-runbtn').style.display = 'none';\n                document.getElementById('inline').style.display = \"\";\n            }\n            if(Config.storageMode === STORAGE_DROPBOX){\n                if(client == null || !client.isAuthenticated()){\n                    dropboxLogin();\n                }else{\n                    initFileSystem();\n                }\n            }else{\n                startEmulator();\n            }\n        }\n        function startEmulator()\n        {\n            isRunning = true;\n\n            document.getElementById('startbtn').style.display = 'none';\n            document.getElementById('sound-checkbox').style.display = 'none';\n\n            var params = getEmulatorParams();\n            for(var i=0; i < params.length; i++) {\n                Module['arguments'].push(params[i]);\n            }\n\n            document.getElementById('startbtn').textContent = \"Running...\";\n            Module[\"removeRunDependency\"](\"setupBoxedWine\");\n        }\n        function loadScreen() {\n            if(Config.isAutoRunSet || Config.isRunningInline) {\n                var canvas = document.getElementById(\"canvas\");\n                var ctx = canvas.getContext(\"2d\");\n                ctx.font = \"40px Arial\";\n                ctx.textAlign = \"center\";\n                ctx.fillText(\"Loading...\", canvas.width/2.5, canvas.height/2);\n            }\n        }\n        var initialSetup = function(){\n            console.log(\"running initial setup\");\n            setConfiguration();\n            //loadScreen();\n\n            Module[\"addRunDependency\"](\"setupBoxedWine\");\n            initFileSystem();\n\n            /* //Not using drop box\n            if(Config.storageMode === STORAGE_DROPBOX){\n                startBtn.textContent = \"Login\";\n                startBtn.disabled = false;\n                startBtn.style.display = \"\";\n            }else{\n                initFileSystem();\n            }\n            */\n        }\n\n        function getExecutable()\n        {\n            var prog =  getParameter(\"p\");\n            if(!allowParameterOverride() || prog===\"\"){\n                console.log(\"not setting program to execute\");\n            }else{\n                if(prog.startsWith(\"%22\") && prog.endsWith(\"%22\")){\n                    prog = prog.substring(3, prog.length - 3);\n                }else if(prog.startsWith('%27') && prog.endsWith('%27')){\n                    prog = prog.substring(3, prog.length - 3);\n                }\n                prog = prog.split('%20').join(' ');\n                console.log(\"setting program to execute to: \"+prog);\n            }\n            return prog;\n        }\n        var errorCallback = function(e){\n            console.log(e);\n        }\n        var dirCount = 0;\n        function getEntriesAsPromise(item, exeFiles, allFiles) {\n            return new Promise((resolve, reject) => {\n                if(item.isDirectory){\n                    dirCount = dirCount + 1;\n                    let reader = item.createReader();\n                    let doBatch = () => {\n                        reader.readEntries(entries => {\n                            if (entries.length > 0) {\n                                entries.forEach(function(entry){\n                                    getEntriesAsPromise(entry, exeFiles, allFiles);\n                                });\n                                doBatch();\n                            } else {\n                                dirCount = dirCount - 1;\n                                if(dirCount == 0){\n                                    if(!Config.isAutoRunSet && !isRunning){\n                                        loadExeModal(exeFiles, allFiles);\n                                    }\n                                }\n                                resolve();\n                            }\n                        }, reject);\n                    };\n                    doBatch();\n                }else{\n                    let fullPath = item.fullPath;\n                    let uppercase = fullPath.toUpperCase();\n                    allFiles.push(fullPath);\n                    if(uppercase.endsWith(\".EXE\") || uppercase.endsWith(\".BAT\")){\n                        exeFiles.push(fullPath);\n                    }\n                    item.file(function(item){uploadFile(item, fullPath, allFiles);}, errorCallback);\n                }\n            });\n        }\n        function loadExeModal(exeFiles, allFiles)\n        {\n            document.getElementById('modalLinkExe').click();\n            var message = document.getElementById('message');\n            message.innerHTML = \"<p>Uploading files...</p>\";\n            timer = setInterval(function(){readyCheck(exeFiles, allFiles);}, 100);\n        }\n        function populateModalExe(exeFiles)\n        {\n            var root = document.getElementById('items');\n            root.innerHTML = '';\n            let listElement = document.createElement(\"lu\");\n            for(let i = 0; i < exeFiles.length; i++) {\n                let fullPath = exeFiles[i];\n                let element = document.createElement(\"li\");\n                element.addEventListener(\"click\", function(event){execute(fullPath);}, false);\n                element.innerHTML = fullPath;\n                listElement.appendChild(element);\n            }\n            root.appendChild(listElement);\n        }\n        function execute(filename)\n        {\n            var root = document.getElementById('items');\n            document.getElementById('openModalExeClick').click();\n\n            var file = extractLastPartOfPath(filename);\n            var path = extractFirstPartOfPath(filename);\n\n            Config.WorkingDir = \"/home/username/.wine/dosdevices/d:/\" + path.substring(1);\n            Config.Program = file;\n\n            startEmulator();\n        }\n        function readyCheck(exeFiles, allFiles)\n        {\n            if(allFiles.length==0){\n                clearInterval(timer);\n                var message = document.getElementById('message');\n                message.innerHTML = '';\n                //populateModalExe(exeFiles);\n            }\n        }\n        dropzone.addEventListener(\"dragover\", function(event){\n            event.preventDefault();\n        }, false);\n        dropzone.addEventListener(\"drop\", function(event){\n            event.preventDefault();\n            //if only i know something about async\n            let items = event.dataTransfer.items;\n            let exeFiles = [];\n            let allFiles = [];\n            for(let i =0; i < items.length; i++){\n                getEntriesAsPromise(items[i].webkitGetAsEntry(), exeFiles, allFiles);\n            }\n        }, false);\n        function isInSubDirectory(fullPath, programDir) {\n            var fileEntry = FS.lookupPath(fullPath, { follow: true });\n            if (fileEntry!= null && fileEntry.node.isFolder) {\n                var entries = FS.readdir(fullPath).filter(function(param) {\n                    return param !== \".\" && param !== \"..\" && param !== \"__MACOSX\";\n                });\n                for(var idx = 0; idx < entries.length; idx++) {\n                    if(entries[idx] === programDir) {\n                        return true;\n                    }\n                }\n            }\n            return false;\n        }\n        function getEmulatorParams() {\n            var params = [\"-root\", \"/root/base\"];\n            params.push(\"-mount_drive\");\n            params.push(Config.appDirPrefix);\n            params.push(\"d\");\n            params.push(\"-nozip\");\n            if(!Config.isSoundEnabled){\n                params.push(\"-nosound\");\n            }\n            if(Config.bpp != DEFAULT_BPP){\n                params.push(\"-bpp\");\n                params.push(\"\" + Config.bpp);\n            }\n            if(Config.cpu.length > 0){\n                params.push(\"-\" + Config.cpu);\n            }\n            if(Config.glext.length > 0){\n                params.push(\"-glext\");\n                params.push(Config.glext);\n            }\n            if(Config.WorkingDir.length > 0){\n                params.push(\"-w\");\n                params.push(Config.WorkingDir);\n            }else if(Config.appPayload.length > 0 && Config.Program.length > 0 && Config.Program.substring(0 ,1) != \"/\"){\n                params.push(\"-w\");\n                params.push(\"/home/username/.wine/dosdevices/d:\");\n            }else if(Config.appZipFile.length > 0 && Config.Program.length > 0 && Config.Program.substring(0 ,1) != \"/\"){\n                var subDirectory = Config.appZipFile.substring(0, Config.appZipFile.lastIndexOf(\".\"));\n                params.push(\"-w\");\n                if(isInSubDirectory(Config.appDirPrefix, subDirectory)){\n                    params.push(\"/home/username/.wine/dosdevices/d:/\" + subDirectory);\n                }else{\n                    params.push(\"/home/username/.wine/dosdevices/d:\");\n                }\n            }\n            params.push(\"/bin/wine\");\n            if(Config.Program.length > 0){\n                if (Config.Program.endsWith('.bat')) {\n                    params.push(\"cmd\");\n                    params.push(\"/c\");\n                }\n                params.push(Config.Program);\n            }else{\n                params.push(\"explorer\");\n                params.push(\"/desktop=shell\");\n            }\n            console.log(\"Emulator params:\" + params);\n            return params;\n        }\n      var Module = {\n        logReadFiles : false, //enable if you want to prune with tools/common utility\n        preRun: [initialSetup],\n        arguments: [],\n        postRun: [],\n        print: (function() {\n          var element = document.getElementById('output');\n          if (element) element.value = ''; // clear browser cache\n          return function(text) {\n            text = Array.prototype.slice.call(arguments).join(' ');\n            // These replacements are necessary if you render to raw HTML\n            //text = text.replace(/&/g, \"&amp;\");\n            //text = text.replace(/</g, \"&lt;\");\n            //text = text.replace(/>/g, \"&gt;\");\n            //text = text.replace('\\n', '<br>', 'g');\n            console.log(text);\n            //remove in browser console\n            /*if (element) { \n              element.value += text + \"\\n\";\n              element.scrollTop = element.scrollHeight; // focus on bottom\n            }\n            */\n          };\n        })(),\n        printErr: function(text) {\n          text = Array.prototype.slice.call(arguments).join(' ');\n          if (0) { // XXX disabled for safety typeof dump == 'function') {\n            dump(text + '\\n'); // fast, straight to the real console\n          } else {\n            console.error(text);\n          }\n        },\n        canvas: (function() {\n          var canvas = document.getElementById('canvas');\n\n          // As a default initial behavior, pop up an alert when webgl context is lost. To make your\n          // application robust, you may want to override this behavior before shipping!\n          // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2\n          canvas.addEventListener(\"webglcontextlost\", function(e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);\n          canvas.width  = 800;\n          canvas.height = 600;\n          return canvas;\n        })(),\n        setStatus: function(text) {\n          if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };\n          if (text === Module.setStatus.text) return;\n          var m = text.match(/([^(]+)\\((\\d+(\\.\\d+)?)\\/(\\d+)\\)/);\n          var now = Date.now();\n          if (m && now - Date.now() < 30) return; // if this is a progress update, skip it if too soon\n          if (m) {\n            text = m[1];\n            progressElement.value = parseInt(m[2])*100;\n            progressElement.max = parseInt(m[4])*100;\n            progressElement.hidden = false;\n            spinnerElement.hidden = false;\n          } else {\n            progressElement.value = null;\n            progressElement.max = null;\n            progressElement.hidden = true;\n            if (!text) spinnerElement.hidden = true;\n          }\n          statusElement.innerHTML = text;\n        },\n        totalDependencies: 0,\n        monitorRunDependencies: function(left) {\n          this.totalDependencies = Math.max(this.totalDependencies, left);\n          Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : '');\n        }\n      };\n      Module.setStatus('Downloading...');\n      window.onerror = function() {\n        Module.setStatus('Exception thrown, see JavaScript console');\n        spinnerElement.style.display = 'none';\n        Module.setStatus = function(text) {\n          if (text) Module.printErr('[post-exception status] ' + text);\n        };\n      };\n\n        function isHomeDirectory(str){\n            if(str.length >= 10){\n                if(str.substring(0,10) === '/root/home'){\n                    return true;\n                }\n            }\n            return false;\n        }\n        function startWithFiles(files){\n            for (let i = 0; i < files.length; i++) {\n                uploadFile(files[i]);\n            }\n        }\n        function uploadFile(file, fullPath, allFiles)\n        {\n            let filename = null;\n            if(fullPath){\n                filename = fullPath.startsWith(\"/\") ? fullPath.substring(1) : fullPath;\n            }else{\n                filename = file.webkitRelativePath.length == 0 ? file.name : file.webkitRelativePath;\n            }\n            var filereader = new FileReader();\n            filereader.file_name = file.name;\n            filereader.onload = function(){readFile(this.result, filename, allFiles)};\n            filereader.readAsArrayBuffer(file);\n        }\n        function extractLastPartOfPath(str){\n                return str.substring(str.lastIndexOf(\"/\")+1,str.length);\n        }\n        function extractFirstPartOfPath(str){\n                return str.substring(0,str.lastIndexOf(\"/\"));\n        }\n        function extractFilenameExtension(str){\n                return str.substring(str.lastIndexOf(\".\")+1,str.length);\n        }\n        function extractFilenameWithoutExtension(str){\n                return str.substring(0, str.lastIndexOf(\".\"));\n        }\n        function readFile(data, name, allFiles){\n            var fileExt = extractFilenameExtension(name);\n            if(fileExt.toLowerCase() === 'zip'){\n                var filenameNoExt = extractFilenameWithoutExtension(name);\n                if(!createFolder(Config.appDirPrefix, filenameNoExt)){//If dir exists and user says no to replace existing dir, then stop here\n                    return;\n                }\n                var zipDirPrefix = Config.appDirPrefix + filenameNoExt;\n                var zip = new JSZip(data);\n                for(var entry in zip.files)\n                {\n                    var data = zip.file(entry);\n                    if(data != null){\n                        var buf = data.asUint8Array();\n                        var parent = zipDirPrefix + \"/\" + extractFirstPartOfPath(entry) ;\n                        var filename = extractLastPartOfPath(entry);\n                        createFile(parent, filename, buf);\n                    }else{ //directory\n                        var fullPath = entry.substring(0,entry.length-1);\n                        var parent = extractFirstPartOfPath(fullPath);\n                        var dir = extractLastPartOfPath(fullPath);\n                        if(parent.length == 0){\n                            parent = zipDirPrefix;\n                        }else{\n                            parent = zipDirPrefix + \"/\" + parent;\n                        }\n                        createFolder(parent, dir);\n                    }\n                }\n            }else{\n                var done = false;\n                var startIndex = 0;\n                var base = Config.appDirPrefix;\n                var filename = extractLastPartOfPath(name);\n                while(!done){\n                    var dirIndex = name.indexOf(\"/\", startIndex);\n                    if(dirIndex == -1){\n                        done =true;\n                    }else{\n                        var dirName = name.substring(startIndex, dirIndex);\n                        var key = base + dirName;\n                        if(dirName.length > 0) {\n                            if(uniqueDirs[key] == null && dirName.length > 0){\n                                createFolder(base, dirName);\n                                uniqueDirs[key] = \"\";\n                            }\n                            base = base + dirName + \"/\";\n                        }\n                        startIndex = dirIndex + 1;\n                    }\n                }\n                createFile(base.substring(0,base.length-1), filename, new Uint8Array(data));\n                if(allFiles){\n                    allFiles.pop(name);\n                }\n            }\n        }\nfunction calcBackupFilename()\n{\n    var d = new Date();\n    var str =d.toISOString();\n    str = \".backup.\" + str.split(\":\").join(\".\");\n    return str;\n}\nfunction createFolder(parent, dir)\n{\n    var created = true;\n    try{\n        FS.createPath(parent, dir, true, true);\n        //console.log(entry + \" is a dir parent=\"+parent+\" dir=\"+dir);\n        //console.log(\"Directory created :\" + parent + \"/\" +  dir);\n    }catch(ef){\n      if(ef.message === \"File exists\" || ef.message === \"FS error\"){\n        console.log(\"Directory already exists! :\" + parent + dir);\n        var replace = confirm(\"Directory already exists: \" + parent + dir+\" continue?\");\n        if(replace){\n            try{\n                //yeah, like that would work! FS.rmdir(parent + dir);\n                FS.rename(parent + dir,parent + dir + calcBackupFilename());\n                FS.createPath(parent, dir, true, true);\n                console.log(\"Directory replaced: \" + parent + dir);\n            }catch(eef){\n                console.log(\"eef=\"+eef);\n                created = false;\n                alert(\"unable to create folder: \"+ parent + dir);\n            }\n        }else{\n            created = false;\n        }\n      }else{\n        console.log(\"ef=\"+ef);\n      }\n    }\n    return created;\n}\nfunction createFile(dir, name, buf)\n{\n    if(dir.includes(\"__MACOSX\")) {\n        return\n    }\n    try{\n        FS.createDataFile(dir, name, buf, true, true);\n        //console.log(\"File created :\" + dir + \"/\" + name);\n    }catch(e){\n      if(e.message === \"File exists\" || e.message === \"FS error\"){\n        console.log(\"File already exists!: \" + dir + name);\n        var replace = confirm(\"File already exists: \" + dir + \"/\" + name+\" replace?\");\n        if(replace){\n            try{\n                FS.unlink(dir + \"/\" + name);\n                FS.createDataFile(dir, name, buf, true, true);\n                console.log(\"File replaced: \" + dir + name);\n            }catch(ee){\n                console.log(\"ee=\"+ee);\n                alert(\"unable to create file: \"+ dir + name);\n            }\n        }\n      }else{\n        console.log(\"e=\"+e);\n      }\n    }\n}\nfunction toggleConsole() {\n    var el = document.getElementById('showConsole');\n    var console = document.getElementById('output');\n    if(el.checked){\n        console.style.display = '';\n    }else{\n        console.style.display = 'none';\n    }\n}\nfunction toggleSound() {\n    var el = document.getElementById('soundToggle');\n    Config.isSoundEnabled = el.checked;\n}\nfunction toggleDirectory(item){\n    var itemWidget =document.getElementById(item);\n    if(itemWidget!=null){\n        if(itemWidget.style.display=='none'){//show\n            itemWidget.style.display=\"\";\n            document.getElementById(item+'-expand').style.display=\"none\";\n            document.getElementById(item+'-contract').style.display=\"\";\n        }else{//hide\n            itemWidget.style.display=\"none\";\n            document.getElementById(item+'-expand').style.display=\"\";\n            document.getElementById(item+'-contract').style.display=\"none\";\n        }\n    }\n}\nfunction getParameter(inputKey){\n    var retVal=\"\";\n    var replacementParameters = Config.urlParams;\n    var url = replacementParameters.length > 0 ? \"?\" + replacementParameters : window.location.href;\n    var index = url.indexOf(\"?\")+1;\n    if(index > 0){\n        var paramStr = url.substring(index);\n        var params = paramStr.split(\"&\");\n        for(var x=0;x<params.length;x++){\n            var param = params[x];\n            var kv = param.split(\"=\");\n            var key = kv[0];\n            if(key === inputKey){\n                retVal = kv[1];\n                break;\n            }\n        }\n    }\n    var hashIndex = retVal.lastIndexOf('#');\n    if(hashIndex > 0 ) {\n        retVal = retVal.substring(0, hashIndex);\n    }\n    return retVal;\n}\nfunction select(index, dir, filename){\n    if(selectedItem != null){\n        selectedItem.style.backgroundColor = \"\";\n    }\n    selectedItem = document.getElementById(index + '-data');\n    selectedItem.style.backgroundColor=\"#94c2c5\";\n    var fullpath = dir;\n    if(filename != null){\n        fullpath = fullpath + filename;\n    }\n    document.getElementById('selectedItem').value = fullpath\n    selectedFilename = filename\n}\nfunction endsWith(str, suffix){\n    return str.indexOf(suffix, str.length - suffix.length) !== -1;\n}\nfunction extract(){\n    if(url != null){\n        window.URL.revokeObjectURL(url);\n    }\n    var file = document.getElementById('selectedItem').value;\n    if(file != null && file.length > 0 && files.length > 1) {\n        if(endsWith(file,\"/\")){\n            file = file.substring(0,file.length - 1);\n        }\n        var isDirectory = false;\n        var outputFilename;\n        if(selectedFilename !=null){\n            outputFilename = selectedFilename;\n        }else{\n            isDirectory = true;\n            outputFilename = file.substring(file.lastIndexOf('/') + 1) + \".zip\";\n        }\n\n        var blob = getFile(file, isDirectory);\n        url = window.URL.createObjectURL(blob);\n        ae.href = url;\n        ae.download = outputFilename;\n        ae.click();\n    }\n}\nfunction done(){\n    if(url != null){\n        window.URL.revokeObjectURL(url);\n    }\n}\nfunction leaf(entry){\n    index++;\n    var text = \"<tr><td ><span id=\\\"\" + index + \"-data\\\" onclick=\\\"select(\" + index + \",'\" + entry.dir + \"','\" + entry.filename + \"')\\\">\" + entry.filename + \"</span></td></tr>\";\n    return text;\n}\nfunction branch(entries){\n    var item = entries[index];\n    index++;\n    var dir = item.dir;\n    var dirName = dir.substring(0, dir.length - 1);\n    dirName = dirName.substring(dirName.lastIndexOf(\"/\")+1,dirName.length);\n    var text = \"<tr>\";\n    text = text + \"<td>\";\n    text = text + \"<span id=\\\"\" + index + \"-expand\\\"><a onclick=\\\"toggleDirectory('\" + index + \"')\\\"><strong>+</strong></a></span>\";\n    text = text + \"<span id=\\\"\" + index + \"-contract\\\" style=\\\"display:none;\\\"><a onclick=\\\"toggleDirectory('\" + index + \"')\\\"><strong>-</strong></a></span>\";\n    text = text + \"<span id=\\\"\" + index + \"-data\\\" onclick=\\\"select(\" + index + \",'\" + dir + \"', null)\\\">[\" + dirName + \"]</span>\";\n    text = text + \"<div id='\" + index + \"' style=\\\"display:none;\\\">\";\n    text = text + \"<table>\";\n    while(index < entries.length){\n        var nextItem = entries[index];\n        if(nextItem.dir === item.dir){\n            text = text + leaf(nextItem);\n        }else if(parentDir(nextItem.dir) === item.dir){\n            text = text + branch(entries, index);\n        }else{\n            break;\n        }\n    }\n    text = text + \"</table>\";\n    text = text + \"</div>\";\n    text = text + \"</td>\";\n    text = text + \"</tr>\";\n    return text;\n}\nfunction parentDir(childDir)\n{\n    if(endsWith(childDir,\"/\")){\n        childDir = childDir.substring(0,childDir.length - 1);\n    }\n    var parentDir= childDir.substring(0, childDir.lastIndexOf('/') + 1);\n    return parentDir;\n}\nfunction buildTree()\n{\n    document.getElementById('modalLink').click();\n    var root = document.getElementById('tree');\n    //reset\n    document.getElementById('selectedItem').value = \"\";\n    selectedFilename = null;\n    files = [];\n    root.innerHTML = \"\";\n    index = 0;\n\n    var currentDir = Config.appDirPrefix;\n    readFiles(currentDir, files);\n\n    //now build tree\n    var contents = \"<table>\";\n    contents = contents + branch(files);\n    contents = contents + \"</table>\";\n    document.getElementById('loadStatus').style.display=\"none\";\n\n    root.innerHTML = contents;\n    toggleDirectory('1');\n}\n\nfunction readFiles(currentDir, files)\n{\n    console.log(\"adding directory: \" + currentDir);\n    files.push({dir : currentDir, filename : \"\"});\n    var entries = FS.readdir(currentDir).filter(function(param) {\n        return param !== \".\" && param !== \"..\";\n    });\n    entries.forEach(function(entry) {\n        var fileEntry = FS.lookupPath(currentDir + entry, { follow: true });\n        if (fileEntry.node.isFolder) {\n            readFiles(currentDir + entry + \"/\", files);\n        }else{\n            console.log(\"adding file: \" + currentDir + entry);\n            files.push({dir : currentDir, filename : entry});\n        }\n    });\n}\n\nfunction startsWith(str, prefix)\n{\n    return str.slice(0, prefix.length) == prefix;\n}\nfunction getFile(file, isDirectory)\n{\n    if(isDirectory){//zip up directory\n        var zip = new JSZip();\n        files.forEach(function(eachFile) {\n            if(startsWith(eachFile.dir, file)){\n                if(eachFile.filename !== \"\"){\n                      var fileLocation = eachFile.dir + eachFile.filename;\n                      var data = FS.readFile(fileLocation, { encoding: 'binary' });\n                      zip.file(fileLocation.substring(file.length), data);\n                }else{\n                        zip.file(eachFile.dir.substring(file.length), null, {dir: true});\n                }\n            }\n        });\n        return zip.generate({type:\"blob\", compression:\"DEFLATE\"});\n    }else{\n        var data = FS.readFile(file, { encoding: 'binary' });\n        return new Blob([data], {type: \"octet/stream\"});\n    }\n}\n"]}